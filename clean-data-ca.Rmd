---
title: "Clean Data CA"
author: "Halina Do-Linh"
date: "1/23/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# attached packages
library(tidyverse)
library(janitor)
library(here)
```

# Read in agency datasets

```{r}
ridb_2020 <- read_csv(here("data", "FY20-historical-reservations-full.csv"))
```

# Tidy

```{r}
ridb_2020_clean <- ridb_2020 %>% 
  janitor::clean_names() %>% 
  select("historicalreservationid",
         "ordernumber",
         "agency",
         "orgid",
         "regioncode", "regiondescription",
         "parentlocationid", "parentlocation",
         "sitetype", "usetype",
         "productid", "inventorytype", 
         "facilityid", "facilityzip", "facilitystate", "facilitylongitude", "facilitylatitude",
         "customerzip", 
         "totalbeforetax",
         "discount", "totalpaid",
         "startdate", "enddate", "orderdate",
         "nights",
         "numberofpeople") %>% 
  filter(facilitystate == "California") %>% 
  mutate(sitetype = tolower(sitetype)) %>% 
  filter(sitetype != c("historic tour",
                      "hiking zone",
                      "group picnic area",
                      "cave tour",
                      "management",
                      "anchorage",
                      "picnic",
                      "entry point",
                      "trailhead")) %>% 
  filter(usetype == "Overnight") %>% 
  mutate(nights = gsub(" days", "", nights)) %>% # used tidyverse gsub to remove day and days
  mutate(nights = as.numeric(gsub(" day", "", nights))) %>% # make the column numeric instead of chr
  filter(customerzip == str_extract_all(customerzip,"[[:digit:]]{5}"))

```
At this point:

- `sitetype`: 
"standard nonelectric"
"group walk to"                   
"walk to"                         
"group standard area nonelectric"  
"group standard nonelectric"      
"tent only nonelectric"            
"group tent only area nonelectric"
‚Äùgroup shelter nonelectric"       
"rv nonelectric"                                        
"tent only electric"                                       
"standard electric"                
"cabin nonelectric"               
"group equestrian"                 
"boat in"                         
"group hike to"                    
"hike to"                         
"rv electric"                      
"cabin electric"                  
"equestrian nonelectric"          
"group standard electric"          
"group standard area electric"    
"yurt"                            
"group rv area nonelectric"        
"shelter nonelectric"
- `sitetype` removed: "group shelter electric", "destination zone", NAs
- `usetype` is only "Overnight"
- `inventorytype` is only "CAMPING"
- `nights` is numeric and removed " day" and " days". When changed to numeric NAs were introduced by coercion. I think this came up because there were some 00:00:00 values and these can't numeric.
- `startdate`, `enddate`, `orderdate` classes are "POSIXct" or "POSIXt" 
- `customerzip` now only contains zip codes with 5 digit numbers; class is character

