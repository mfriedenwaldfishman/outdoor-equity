---
title: "Mock up of 'Data Relationships'"
author: "Clarissa"
date: "4/12/2022"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE, eval=TRUE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, eval = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(tidycensus)
library(patchwork)
library(scales)
library(vroom)
library(paletteer)
library(ggridges)
library(plotly)

options(scipen = 999)
```

```{r, eval=TRUE}
start_time <- Sys.time()
```

```{r, eval=TRUE}
# read in joined data
data_ridb_acs_2018 <- vroom(file = "../../../../data_clean/2018_joined_data.csv",
                            delim = ",") ## non-map graphs (no geometries)
# data_ridb_acs_2018 <- readRDS(file = "../../../../data_clean/2018_joined_data.rds") ## maps (don't use RDS for non-map viz, too slow)

data_ca_acs_2018 <- vroom(file = "../../../../data_clean/2018_ca_acs_all.csv",
                          delim = ",")
```

## Race x ____

### Race x distance traveled

```{r, eval=TRUE}
## -- data wrangle -- ##
racial_groups <- c("other", "pacific_islander", "multiracial", "asian", 
                   "black", "white", "native_american", "hispanic_latinx")

data_plot_race_distance_traveled <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(racial_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>%
    select(zip_code, asian, black, hispanic_latinx, multiracial,
           native_american, other, pacific_islander, white, mean_zip_code_population) %>%
    pivot_longer(cols = 2:9,
                 names_to = "race",
                 values_to = "race_percentage") %>%
    filter(race == racial_groups[[i]]) %>% ## BACK TO i
    drop_na(race_percentage)

  weighted_half <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(race_percentage >= weighted_half)

  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_racial_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, asian, black, hispanic_latinx, 
           multiracial, native_american, other, pacific_islander, white,
           distance_traveled_m) %>% 
    mutate(distance_traveled_mi = distance_traveled_m * 0.000621371) %>% 
    drop_na(distance_traveled_mi) %>% 
  pivot_longer(cols = 5:12,
               names_to = "race",
               values_to = "race_percentage") %>% 
    filter(race == racial_groups[[i]]) %>% ## BACK TO i
    drop_na(race_percentage)

  max_racial_group_ridb <- df_racial_group_i_longer %>%
    summarize(max = max(race_percentage))

  df_racial_group_i <- df_racial_group_i_longer %>%
    filter(race_percentage >= weighted_quartile) %>% 
    summarize(mean_distance_traveled_mi = mean(distance_traveled_mi)) %>% 
    mutate(race = paste0(racial_groups[[i]])) %>%  ## BACK TO i
    relocate(race, .before = 1) %>% 
    mutate(race = str_replace(string = race,
                              pattern = "_",
                              replacement = " "),
           race = str_to_title(race),
           race = str_replace(string = race,
                              pattern = "Other",
                              replacement = "Other Race(s)"))

  data_plot_race_distance_traveled <- rbind(data_plot_race_distance_traveled, df_racial_group_i)

  assign(paste0("top_quartile_ca_race_", racial_groups[[i]]),
         c(weighted_quartile),
         envir = .GlobalEnv)
  assign(paste0("max_race_ridb_", racial_groups[[i]]),
         data.frame(max_racial_group_ridb),
         envir = .GlobalEnv)
}


## -- create plot -- ##
racial_group_colors <- c("Other Race(s)" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")


# plot for shiny
plot_race_distance_traveled <- ggplot(data = data_plot_race_distance_traveled, 
                                      aes(x = mean_distance_traveled_mi,
                                          y = reorder(race, mean_distance_traveled_mi))) +
  geom_segment(aes(xend = 0, yend = race)) +
  geom_point(aes(x = mean_distance_traveled_mi,
                 y = reorder(race, mean_distance_traveled_mi),
                 color = race, fill = race,
                 text = paste("People who live in ZIP codes with high", 
                              str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), "populations",
                             "<br>travel an estimated distance of", round(mean_distance_traveled_mi, 0), "miles to overnight reservable sites.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = racial_group_colors) +
  scale_color_manual(values = racial_group_colors) +
  labs(x = paste("Average Distance Traveled from Home to Site (miles)"),
       y = "",
       title = "Average Distance Traveled to Reservation for <br>Different Racial Groups") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_distance_traveled,
         tooltip = list("text"))
```


### Race x site type 

```{r, eval=TRUE}
## -- data wrangle -- ##
racial_groups <- c("other", "pacific_islander", "multiracial", "asian", 
                   "black", "white", "native_american", "hispanic_latinx")
site_types_groups <- c("equestrian", "remote", "rv only", "rv or tent", "shelter", "tent only", "water")

data_plot_race_site_type <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(racial_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>%
    select(zip_code, asian, black, hispanic_latinx, multiracial,
           native_american, other, pacific_islander, white, mean_zip_code_population) %>%
    pivot_longer(cols = 2:9,
                 names_to = "race",
                 values_to = "race_percentage") %>%
    filter(race == racial_groups[[i]]) %>% ## BACK TO i
    drop_na(race_percentage)

  weighted_half <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(race_percentage >= weighted_half)

  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_racial_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, asian, black, hispanic_latinx, 
           multiracial, native_american, other, pacific_islander, white,
           aggregated_site_type) %>% 
    drop_na(aggregated_site_type) %>% 
    pivot_longer(cols = 5:12,
                 names_to = "race",
                 values_to = "race_percentage") %>% 
    filter(race == racial_groups[[i]]) %>% ## BACK TO i
    drop_na(race_percentage)

  max_racial_group_ridb <- df_racial_group_i_longer %>%
    summarize(max = max(race_percentage))

  df_racial_group_i <- df_racial_group_i_longer %>%
    filter(race_percentage >= weighted_quartile) %>% 
    count(race, aggregated_site_type) %>% 
    mutate(race = paste0(racial_groups[[i]])) %>%  ## BACK TO i
    relocate(race, .before = 1) %>% 
    mutate(race = str_replace(string = race,
                              pattern = "_",
                              replacement = " "),
           race = str_to_title(race),
           race = str_replace(string = race,
                              pattern = "Other",
                              replacement = "Other Race(s)"))
  
  data_plot_race_site_type <- rbind(data_plot_race_site_type, df_racial_group_i)
  
  for (j in seq_along(site_types_groups)){
    site_df <- data_plot_race_site_type %>% 
      filter(aggregated_site_type == site_types_groups[[j]]) %>% 
      mutate(sum_n = sum(n),
             percent_n = n / sum_n)
    
    assign(paste0("data_plot_race_site_type_", 
                  str_replace_all(string = site_types_groups[[j]],
                                  pattern = " ",
                                  replacement = ".")),
           data.frame(site_df), envir = .GlobalEnv)
  }

  assign(paste0("top_quartile_ca_race_", racial_groups[[i]]),
         c(weighted_quartile),
         envir = .GlobalEnv)
  assign(paste0("max_race_ridb_", racial_groups[[i]]),
         data.frame(max_racial_group_ridb),
         envir = .GlobalEnv)
}


## -- create plot -- ##
racial_group_colors <- c("Other Race(s)" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")
```


```{r}
# plot for shiny

# stacked all sites in one plot
data_plot_race_site_type <- rbind(data_plot_race_site_type_equestrian, data_plot_race_site_type_remote,
                                  data_plot_race_site_type_rv.only, data_plot_race_site_type_rv.or.tent,
                                  data_plot_race_site_type_shelter, data_plot_race_site_type_tent.only,
                                  data_plot_race_site_type_water) %>% 
  mutate(race = factor(race, levels = c("White", "Hispanic Latinx", "Asian", 
                                        "Black", "Multiracial", "Native American",
                                        "Pacific Islander", "Other Race(s)")),
         aggregated_site_type = str_to_title(string = aggregated_site_type) %>% 
           str_replace(string = ., pattern = "Rv", replacement = "RV"))

plot_race_site_type <- ggplot(data = data_plot_race_site_type, 
                              aes(x = percent_n,
                                  y = aggregated_site_type, fill = fct_rev(race),
                                  text = paste0("Of visits to ", str_to_lower(aggregated_site_type) %>% 
                                                  str_replace(string = ., pattern = "rv", replacement = "RV"), 
                                                " overnight reservable sites, ", scales::percent(percent_n, accuracy = 0.1),
                                                " reservations were made by <br>people who live in ZIP codes with high ", 
                                                str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), " populations."))) +
  geom_col(position = "stack") +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total Reservations per Site Type Group"),
       y = "",
       title = paste0("Percentage of Reservations to Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_site_type,
         tooltip = list("text"))
```

```{r, eval=TRUE}
# equestrian
data <- data_plot_race_site_type_equestrian
data_string <- deparse(substitute(data_plot_race_site_type_equestrian))

plot_race_site_type_equestrian <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = reorder(race, percent_n))) +
  # geom_segment(aes(xend = 0, yend = reorder(race, percent_n))) +
  geom_col(aes(x = percent_n,
                 y = reorder(race, percent_n),
                 #color = race, 
                 fill = race,
                 text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", scales::percent(percent_n, accuracy = 0.1),
                              " reservations were made by <br>people who live in ZIP codes with high ", 
                              str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), " populations.")),
             # width = .25,
             # size = 4, shape = 21, stroke = 2
             ) +
  scale_fill_manual(values = racial_group_colors) +
  scale_color_manual(values = racial_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_site_type_equestrian,
         tooltip = list("text"))
```

```{r, eval=TRUE}
# remote
data <- data_plot_race_site_type_remote
data_string <- deparse(substitute(data_plot_race_site_type_remote))

plot_race_site_type_remote <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = reorder(race, percent_n))) +
  # geom_segment(aes(xend = 0, yend = reorder(race, percent_n))) +
  geom_col(aes(x = percent_n,
                 y = reorder(race, percent_n),
                 #color = race, 
                 fill = race,
                 text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", 
                               percent(percent_n, accuracy = 0.1),
                              " reservations were made by <br>people who live in ZIP codes with high ", 
                              str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), " populations.")),
             # width = .25,
             # size = 4, shape = 21, stroke = 2
             ) +
  scale_fill_manual(values = racial_group_colors) +
  scale_color_manual(values = racial_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_site_type_remote,
         tooltip = list("text"))
```

```{r, eval=TRUE}
# RV Only
data <- data_plot_race_site_type_rv.only
data_string <- deparse(substitute(data_plot_race_site_type_rv.only))

plot_race_site_type_rv_only <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = reorder(race, percent_n))) +
  # geom_segment(aes(xend = 0, yend = reorder(race, percent_n))) +
  geom_col(aes(x = percent_n,
                 y = reorder(race, percent_n),
                 #color = race, 
                 fill = race,
                 text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", scales::percent(percent_n, accuracy = 0.1),
                              " reservations were made by <br>people who live in ZIP codes with high ", 
                              str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), " populations.")),
             # width = .25,
             # size = 4, shape = 21, stroke = 2
           ) +
  scale_fill_manual(values = racial_group_colors) +
  scale_color_manual(values = racial_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_site_type_rv_only,
         tooltip = list("text"))
```

```{r, eval=TRUE}
# RV or Tent
data <- data_plot_race_site_type_rv.or.tent
data_string <- deparse(substitute(data_plot_race_site_type_rv.or.tent))

plot_race_site_type_rv_or_tent <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = reorder(race, percent_n))) +
  # geom_segment(aes(xend = 0, yend = reorder(race, percent_n))) +
  geom_col(aes(x = percent_n,
                 y = reorder(race, percent_n),
                 # color = race, 
               fill = race,
                 text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", scales::percent(percent_n, accuracy = 0.1),
                              " reservations were made by <br>people who live in ZIP codes with high ", 
                              str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), " populations.")),
             # width = .25,
             # size = 4, shape = 21, stroke = 2
           ) +
  scale_fill_manual(values = racial_group_colors) +
  scale_color_manual(values = racial_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_site_type_rv_or_tent,
         tooltip = list("text"))
```

```{r, eval=TRUE}
# Shelter
data <- data_plot_race_site_type_shelter
data_string <- deparse(substitute(data_plot_race_site_type_shelter))

plot_race_site_type_shelter <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = reorder(race, percent_n))) +
  # geom_segment(aes(xend = 0, yend = reorder(race, percent_n))) +
  geom_col(aes(x = percent_n,
                 y = reorder(race, percent_n),
                 # color = race, 
               fill = race,
                 text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", scales::percent(percent_n, accuracy = 0.1),
                              " reservations were made by <br>people who live in ZIP codes with high ", 
                              str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), " populations.")),
             # width = .25,
             # size = 4, shape = 21, stroke = 2
             ) +
  scale_fill_manual(values = racial_group_colors) +
  scale_color_manual(values = racial_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_site_type_shelter,
         tooltip = list("text"))
```

```{r, eval=TRUE}
# Tent Only
data <- data_plot_race_site_type_tent.only
data_string <- deparse(substitute(data_plot_race_site_type_tent.only))

plot_race_site_type_tent_only <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = reorder(race, percent_n))) +
  # geom_segment(aes(xend = 0, yend = reorder(race, percent_n))) +
  geom_col(aes(x = percent_n,
               y = reorder(race, percent_n),
               #color = race, 
               fill = race,
                 text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", scales::percent(percent_n, accuracy = 0.1),
                              " reservations were made by <br>people who live in ZIP codes with high ", 
                              str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), " populations.")),
             # width = .25,
             # size = 4, shape = 21, stroke = 2
           ) +
  scale_fill_manual(values = racial_group_colors) +
  scale_color_manual(values = racial_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_site_type_tent_only,
         tooltip = list("text"))
```

```{r, eval=TRUE}
# Water
data <- data_plot_race_site_type_water
data_string <- deparse(substitute(data_plot_race_site_type_water))

plot_race_site_type_water <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = reorder(race, percent_n))) +
  # geom_segment(aes(xend = 0, yend = reorder(race, percent_n))) +
  geom_col(aes(x = percent_n,
               y = reorder(race, percent_n),
               #color = race, 
               fill = race,
                 text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", scales::percent(percent_n, accuracy = 0.1),
                              "%eservations were made by <br>people who live in ZIP codes with high ", 
                              str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), " populations.")),
             # width = .25,
             # size = 4, shape = 21, stroke = 2
           ) +
  scale_fill_manual(values = racial_group_colors) +
  scale_color_manual(values = racial_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_site_type_water,
         tooltip = list("text"))
```



### Race x booking window 

```{r}
## -- data wrangle -- ##
racial_groups <- c("other", "pacific_islander", "multiracial", "asian", 
                   "black", "white", "native_american", "hispanic_latinx")

data_plot_race_booking_window <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(racial_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>%
    select(zip_code, asian, black, hispanic_latinx, multiracial,
           native_american, other, pacific_islander, white, mean_zip_code_population) %>%
    pivot_longer(cols = 2:9,
                 names_to = "race",
                 values_to = "race_percentage") %>%
    filter(race == racial_groups[[i]]) %>% ## BACK TO i
    drop_na(race_percentage)

  weighted_half <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(race_percentage >= weighted_half)

  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_racial_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, asian, black, hispanic_latinx, 
           multiracial, native_american, other, pacific_islander, white,
           booking_window) %>% 
    drop_na(booking_window) %>% 
  pivot_longer(cols = 5:12,
               names_to = "race",
               values_to = "race_percentage") %>% 
    filter(race == racial_groups[[i]]) %>% ## BACK TO i
    drop_na(race_percentage)

  max_racial_group_ridb <- df_racial_group_i_longer %>%
    summarize(max = max(race_percentage))

  df_racial_group_i <- df_racial_group_i_longer %>%
    filter(race_percentage >= weighted_quartile) %>% 
    summarize(mean_booking_window = mean(booking_window)) %>% 
    mutate(race = paste0(racial_groups[[i]])) %>%  ## BACK TO i
    relocate(race, .before = 1) %>% 
    mutate(race = str_replace(string = race,
                              pattern = "_",
                              replacement = " "),
           race = str_to_title(race),
           race = str_replace(string = race,
                              pattern = "Other",
                              replacement = "Other Race(s)"))

  data_plot_race_booking_window <- rbind(data_plot_race_booking_window, df_racial_group_i)
    
assign(paste0("top_quartile_ca_race_", racial_groups[[i]]),
       c(weighted_quartile),
       envir = .GlobalEnv)
assign(paste0("max_race_ridb_", racial_groups[[i]]),
       data.frame(max_racial_group_ridb),
       envir = .GlobalEnv)
}


## -- create plot -- ##
racial_group_colors <- c("Other Race(s)" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")


# plot for shiny
plot_race_booking_window <- ggplot(data = data_plot_race_booking_window, 
                                      aes(x = mean_booking_window,
                                          y = reorder(race, mean_booking_window))) +
  geom_segment(aes(xend = 0, yend = race)) +
  geom_point(aes(x = mean_booking_window,
                 y = reorder(race, mean_booking_window),
                 color = race, fill = race,
                 text = paste("People who live in ZIP codes with high", 
                              str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), 
                              "populations",
                             "<br>tend to make their reservations", round(mean_booking_window, 0), "days before their visit to overnight reservable sites.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = racial_group_colors) +
  scale_color_manual(values = racial_group_colors) +
  labs(x = paste("Average Number of Days from Order Date to Reservation Date"),
       y = "",
       title = "Average Number of Days in Advance <br>Reservation is Booked for Different Racial Groups") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_booking_window,
         tooltip = list("text"))
```


### Race x daily cost 
```{r}
### need to update data to not be daily cost / visitor / day (but instead cost / day)

## -- data wrangle -- ##
racial_groups <- c("other", "pacific_islander", "multiracial", "asian", 
                   "black", "white", "native_american", "hispanic_latinx")

data_plot_race_daily_cost <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(racial_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>%
    select(zip_code, asian, black, hispanic_latinx, multiracial,
           native_american, other, pacific_islander, white, mean_zip_code_population) %>%
    pivot_longer(cols = 2:9,
                 names_to = "race",
                 values_to = "race_percentage") %>%
    filter(race == racial_groups[[i]]) %>% ## BACK TO i
    drop_na(race_percentage)

  weighted_half <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(race_percentage >= weighted_half)

  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_racial_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, asian, black, hispanic_latinx, 
           multiracial, native_american, other, pacific_islander, white,
           daily_cost) %>% 
    drop_na(daily_cost) %>% 
    filter(daily_cost != Inf) %>% 
  pivot_longer(cols = 5:12,
               names_to = "race",
               values_to = "race_percentage") %>% 
    filter(race == racial_groups[[i]]) %>% ## BACK TO i
    drop_na(race_percentage)
  
  max_racial_group_ridb <- df_racial_group_i_longer %>%
    summarize(max = max(race_percentage))

  df_racial_group_i <- df_racial_group_i_longer %>%
    filter(race_percentage >= weighted_quartile) %>% 
    summarize(mean_daily_cost = mean(daily_cost)) %>% 
    mutate(race = paste0(racial_groups[[i]])) %>%  ## BACK TO i
    relocate(race, .before = 1) %>% 
    mutate(race = str_replace(string = race,
                              pattern = "_",
                              replacement = " "),
           race = str_to_title(race),
           race = str_replace(string = race,
                              pattern = "Other",
                              replacement = "Other Race(s)"))

  data_plot_race_daily_cost <- rbind(data_plot_race_daily_cost, df_racial_group_i)
    
assign(paste0("top_quartile_ca_race_", racial_groups[[i]]),
       c(weighted_quartile),
       envir = .GlobalEnv)
assign(paste0("max_race_ridb_", racial_groups[[i]]),
       data.frame(max_racial_group_ridb),
       envir = .GlobalEnv)
}


## -- create plot -- ##
racial_group_colors <- c("Other Race(s)" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")


# plot for shiny
plot_race_daily_cost <- ggplot(data = data_plot_race_daily_cost, 
                                      aes(x = mean_daily_cost,
                                          y = reorder(race, mean_daily_cost))) +
  geom_segment(aes(xend = 0, yend = race)) +
  geom_point(aes(x = mean_daily_cost,
                 y = reorder(race, mean_daily_cost),
                 color = race, fill = race,
                 text = paste0("People who live in ZIP codes with high ", 
                               str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), " populations ",
                             "<br>pay an average of ", scales::dollar(mean_daily_cost), " per day for overnight reservable sites.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = racial_group_colors) +
  scale_color_manual(values = racial_group_colors) +
  scale_x_continuous(labels = scales::dollar) +
  labs(x = paste("Average Daily Cost of Reservation"),
       y = "",
       title = "Average Daily Cost for <br>Different Racial Groups") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_daily_cost,
         tooltip = list("text"))
```


### Race x length of stay 

```{r}
## -- data wrangle -- ##
racial_groups <- c("other", "pacific_islander", "multiracial", "asian", 
                   "black", "white", "native_american", "hispanic_latinx")

data_plot_race_lenth_of_stay <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(racial_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>%
    select(zip_code, asian, black, hispanic_latinx, multiracial,
           native_american, other, pacific_islander, white, mean_zip_code_population) %>%
    pivot_longer(cols = 2:9,
                 names_to = "race",
                 values_to = "race_percentage") %>%
    filter(race == racial_groups[[i]]) %>% ## BACK TO i
    drop_na(race_percentage)

  weighted_half <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(race_percentage >= weighted_half)

  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_racial_group_i_longer <- data_ridb_acs_2018 %>% 
    select(park, customer_zip, asian, black, hispanic_latinx, 
           multiracial, native_american, other, pacific_islander, white,
           length_of_stay) %>% 
    drop_na(length_of_stay) %>% 
    filter(length_of_stay >= 0) %>% 
  pivot_longer(cols = 5:12,
               names_to = "race",
               values_to = "race_percentage") %>% 
    filter(race == racial_groups[[i]]) %>% ## BACK TO i
    drop_na(race_percentage)
  
  max_racial_group_ridb <- df_racial_group_i_longer %>%
    summarize(max = max(race_percentage))

  df_racial_group_i <- df_racial_group_i_longer %>%
    filter(race_percentage >= weighted_quartile) %>% 
    summarize(mean_length_of_stay = mean(length_of_stay)) %>% 
    mutate(race = paste0(racial_groups[[i]])) %>%  ## BACK TO i
    relocate(race, .before = 1) %>% 
    mutate(race = str_replace(string = race,
                              pattern = "_",
                              replacement = " "),
           race = str_to_title(race),
           race = str_replace(string = race,
                              pattern = "Other",
                              replacement = "Other Race(s)"))

  data_plot_race_lenth_of_stay <- rbind(data_plot_race_lenth_of_stay, df_racial_group_i)
    
assign(paste0("top_quartile_ca_race_", racial_groups[[i]]),
       c(weighted_quartile),
       envir = .GlobalEnv)
assign(paste0("max_race_ridb_", racial_groups[[i]]),
       data.frame(max_racial_group_ridb),
       envir = .GlobalEnv)
}


## -- create plot -- ##
racial_group_colors <- c("Other Race(s)" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")


# plot for shiny
plot_race_lenth_of_stay <- ggplot(data = data_plot_race_lenth_of_stay, 
                                      aes(x = mean_length_of_stay,
                                          y = reorder(race, mean_length_of_stay))) +
  geom_segment(aes(xend = 0, yend = race)) +
  geom_point(aes(x = mean_length_of_stay,
                 y = reorder(race, mean_length_of_stay),
                 color = race, fill = race,
                 text = paste0("People who live in ZIP codes with high ", 
                               str_to_title(race) %>% str_replace(string = ., pattern = "\\(S\\)", "\\(s\\)"), " populations ",
                             "<br>stay at overnight reservable sites for an estimated ", round(mean_length_of_stay, 0), " days.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = racial_group_colors) +
  scale_color_manual(values = racial_group_colors) +
  labs(x = paste("Average Length of Stay"),
       y = "",
       title = "Average Length of Stay for <br>Different Racial Groups") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_race_lenth_of_stay,
         tooltip = list("text"))
```


```{r}
# print "high" percentage range for each race
print(paste0("A high presence was calculated as anything above the upper weighted quartile for each racial group for the state of California."))
             
print(paste0("White: ", round(top_quartile_ca_race_white, 4)*100, " - ", round(max_race_ridb_white, 4) *100, "%"))
             
print(paste0("Hispanic Latinx: ", round(top_quartile_ca_race_hispanic_latinx, 4)*100, " - ", round(max_race_ridb_hispanic_latinx, 4) *100, "%"))
             
print(paste0("Asian: ", round(top_quartile_ca_race_asian, 4)*100, " - ", round(max_race_ridb_asian, 4) *100, "%"))
             
print(paste0("Black: ", round(top_quartile_ca_race_black, 4)*100, " - ", round(max_race_ridb_black, 4) *100, "%"))
             
print(paste0("Multiracial: ", round(top_quartile_ca_race_multiracial, 4)*100, " - ", round(max_race_ridb_multiracial, 4) *100, "%"))
             
print(paste0("Native American: ", round(top_quartile_ca_race_native_american, 4)*100, " - ", round(max_race_ridb_native_american, 4) *100, "%"))
             
print(paste0("Pacific Islander: ", round(top_quartile_ca_race_pacific_islander, 4)*100, " - ", round(max_race_ridb_pacific_islander, 4) *100, "%"))
             
print(paste0("Other Race(s): ", round(top_quartile_ca_race_other, 4)*100, " - ", round(max_race_ridb_other, 4) *100, "%"))
```


```{r}
# # check # of reservations in each "high" race categories
# test_df <- data_plot_race_site_type
# 
# test_white <- test_df %>% filter(race == "White")
# test_white <- sum(test_white$n)
# test_hisp_lat <- test_df %>% filter(race == "Hispanic Latinx")
# test_hisp_lat <- sum(test_hisp_lat$n)
# test_asian <- test_df %>% filter(race == "Asian")
# test_asian <- sum(test_asian$n)
# test_black <- test_df %>% filter(race == "Black")
# test_black <- sum(test_black$n)
# test_multiracial <- test_df %>% filter(race == "Multiracial")
# test_multiracial <- sum(test_multiracial$n)
# test_nat_am <- test_df %>% filter(race == "Native American")
# test_nat_am <- sum(test_nat_am$n)
# test_pac_isl <- test_df %>% filter(race == "Pacific Islander")
# test_pac_isl <- sum(test_pac_isl$n)
# test_other <- test_df %>% filter(race == "Other Race(s)")
# test_other <- sum(test_other$n)
# test <- c("white" = test_white, "hispanic_latinx" = test_hisp_lat, "asian" = test_asian, "black" = test_black, "multiracial" = test_multiracial, "native_american" = test_nat_am, "pacific_islander" = test_pac_isl, "other" = test_other)
# 
# comma(test)
```

```{r}
## trying to figure out purr

# racial_groups <- c("other", "pacific_islander", "multiracial", "asian", 
#                    "black", "white", "native_american", "hispanic_latinx")
# 
# 
# data_ca_acs_2018 %>% 
#   select(zip_code, asian, black, hispanic_latinx, multiracial, 
#              native_american, other, pacific_islander, white, mean_zip_code_population) %>% 
#       pivot_longer(cols = 2:9,
#                    names_to = "race",
#                    values_to = "race_percent") %>%
#   map(racial_groups, 
#     ~ (race == .)
# )



```




## Education x ____


### Education x distance traveled 

```{r}
## -- data wrangle -- ##
education_groups <- c("hs_GED_or_below", "some_college", "college", "master_or_above")

data_plot_education_distance_traveled <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(education_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>% 
    select(zip_code, hs_GED_or_below, some_college, college, master_or_above, mean_zip_code_population) %>% 
    pivot_longer(cols = 2:5,
                 names_to = "education",
                 values_to = "education_percentage") %>% 
    filter(education == education_groups[[i]]) %>% ## BACK TO i
    drop_na(education_percentage) 
  
  weighted_half <- weighted.mean(x = df_ca_bin_breaks$education_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(education_percentage >= weighted_half)
  
  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$education_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_education_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, hs_GED_or_below, some_college, college, master_or_above,
           distance_traveled_m) %>% 
    mutate(distance_traveled_mi = distance_traveled_m * 0.000621371) %>% 
    drop_na(distance_traveled_mi) %>% 
  pivot_longer(cols = 5:8,
               names_to = "education",
               values_to = "education_percentage") %>% 
    filter(education == education_groups[[i]]) %>% ## BACK TO i
    drop_na(education_percentage)
  
  max_education_group_ridb <- df_education_group_i_longer %>%
    summarize(max = max(education_percentage))
  
  df_education_i_group <- df_education_group_i_longer %>% 
    filter(education_percentage >= weighted_quartile) %>% 
    summarize(mean_distance_traveled_mi = mean(distance_traveled_mi)) %>% 
    mutate(education = paste0(education_groups[[i]])) %>%  ## BACK TO i
    relocate(education, .before = 1) %>% 
    mutate(education = str_replace_all(string = education,
                                       pattern = "_",
                                       replacement = " "),
           education = str_to_title(education),
           education = str_replace(string = education,
                                   pattern = "Hs Ged Or", 
                                   replacement = "HS, GED, or"),
           education = str_replace(string = education,
                                   pattern = "Some College",
                                   replacement = "Some College or Trade School"),
           education = str_replace(string = education,
                                   pattern = "^College$",
                                   replacement = "Associates or Bachelors Degree"),
           education = str_replace(string = education,
                                   pattern = "Master Or Above",
                                   replacement = "Masters Degree or Above"))

  data_plot_education_distance_traveled <- rbind(data_plot_education_distance_traveled, df_education_i_group) %>% 
    mutate(education = factor(education, levels = c("HS, GED, or Below", "Some College or Trade School", 
                                                    "Associates or Bachelors Degree", "Masters Degree or Above")))
    
assign(paste0("top_quartile_ca_education_", education_groups[[i]]), 
       c(weighted_quartile), 
       envir = .GlobalEnv)
assign(paste0("max_education_ridb_", education_groups[[i]]), 
       data.frame(max_education_group_ridb), 
       envir = .GlobalEnv)
}


## -- create plot -- ##

education_group_colors <- c("HS, GED, or Below" = "#a6cee3", "Some College or Trade School"  = "#1f78b4", 
                      "Associates or Bachelors Degree" = "#b2df8a", "Masters Degree or Above" = "#33a02c")

plot_education_distance_traveled <- ggplot(data = data_plot_education_distance_traveled, 
                                      aes(x = mean_distance_traveled_mi,
                                          y = education)) +
  geom_segment(aes(xend = 0, yend = education)) +
  geom_point(aes(x = mean_distance_traveled_mi,
                 y = education,
                 color = education, fill = education,
                 text = paste("Those who live in ZIP codes with high rates of a<br>", 
                              education, "as the highest level of education <br>travel an estimated distance of",
                              round(mean_distance_traveled_mi, 0), "miles to overnight reservable sites.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = education_group_colors) +
  scale_color_manual(values = education_group_colors) +
  labs(x = paste("Average Distance Traveled from Home to Site (miles)"),
       y = "",
       title = "Average Distance Traveled to Reservation for <br>Different Educational Level Groups") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_education_distance_traveled,
         tooltip = list("text"))
```



### Education x site type 

```{r}
## -- data wrangle -- ##
education_groups <- c("hs_GED_or_below", "some_college", "college", "master_or_above")

site_types_groups <- c("equestrian", "remote", "rv only", "rv or tent", "shelter", "tent only", "water")

data_plot_education_site_type <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(education_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>% 
    select(zip_code, hs_GED_or_below, some_college, college, master_or_above, mean_zip_code_population) %>% 
    pivot_longer(cols = 2:5,
                 names_to = "education",
                 values_to = "education_percentage") %>% 
    filter(education == education_groups[[i]]) %>% ## BACK TO i
    drop_na(education_percentage) 
  
  weighted_half <- weighted.mean(x = df_ca_bin_breaks$education_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(education_percentage >= weighted_half)
  
  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$education_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_education_group_i_longer <- data_ridb_acs_2018 %>% 
    select(park, customer_zip, hs_GED_or_below, 
           some_college, college, master_or_above, aggregated_site_type) %>% 
    drop_na(aggregated_site_type) %>% 
    pivot_longer(cols = 3:6,
                 names_to = "education",
                 values_to = "education_percentage") %>% 
    filter(education == education_groups[[i]]) %>% ## BACK TO i
    drop_na(education_percentage)

  max_education_group_ridb <- df_education_group_i_longer %>%
    summarize(max = max(education_percentage))

  df_education_group_i <- df_education_group_i_longer %>%
    filter(education_percentage >= weighted_quartile) %>% 
    count(education, aggregated_site_type) %>% 
    mutate(education = paste0(education_groups[[i]])) %>%  ## BACK TO i
    relocate(education, .before = 1) %>% 
    mutate(education = str_replace_all(string = education,
                              pattern = "_",
                              replacement = " "),
           education = str_to_title(education),
           education = str_replace(string = education,
                                   pattern = "Hs Ged Or", 
                                   replacement = "HS, GED, or"),
           education = str_replace(string = education,
                                   pattern = "Some College",
                                   replacement = "Some College or Trade School"),
           education = str_replace(string = education,
                                   pattern = "^College$",
                                   replacement = "Associates or Bachelors Degree"),
           education = str_replace(string = education,
                                   pattern = "Master Or Above",
                                   replacement = "Masters Degree or Above"))
  
  data_plot_education_site_type <- rbind(data_plot_education_site_type, df_education_group_i) %>% 
    mutate(education = factor(education, levels = c("HS, GED, or Below", "Some College or Trade School", 
                                                    "Associates or Bachelors Degree", "Masters Degree or Above")))
  
  for (j in seq_along(site_types_groups)){
    site_df <- data_plot_education_site_type %>% 
      filter(aggregated_site_type == site_types_groups[[j]]) %>% 
      mutate(sum_n = sum(n),
             percent_n = n / sum_n)
    
    assign(paste0("data_plot_education_site_type_", 
                  str_replace_all(string = site_types_groups[[j]],
                                  pattern = " ",
                                  replacement = ".")),
           data.frame(site_df), envir = .GlobalEnv)
  }

  assign(paste0("top_quartile_ca_education_", education_groups[[i]]),
         c(weighted_quartile),
         envir = .GlobalEnv)
  assign(paste0("max_education_ridb_", education_groups[[i]]),
         data.frame(max_education_group_ridb),
         envir = .GlobalEnv)
}


## -- create plot -- ##
education_group_colors <- c("HS, GED, or Below" = "#a6cee3", "Some College or Trade School"  = "#1f78b4", 
                      "Associates or Bachelors Degree" = "#b2df8a", "Masters Degree or Above" = "#33a02c")

# plot for shiny

# stacked all sites in one plot
data_plot_education_site_type <- rbind(data_plot_education_site_type_equestrian, data_plot_education_site_type_remote,
                                  data_plot_education_site_type_rv.only, data_plot_education_site_type_rv.or.tent,
                                  data_plot_education_site_type_shelter, data_plot_education_site_type_tent.only,
                                  data_plot_education_site_type_water) %>% 
  mutate(aggregated_site_type = str_to_title(string = aggregated_site_type) %>% 
           str_replace(string = ., pattern = "Rv", replacement = "RV"))

plot_education_site_type <- ggplot(data = data_plot_education_site_type, 
                              aes(x = percent_n,
                                  y = aggregated_site_type, fill = fct_rev(education),
                                  text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", scales::percent(percent_n, accuracy = 0.1),
                                                " of reservations were made by ",
                                                "<br>people who live in ZIP codes with ", 
                                                education, " as the highest level of education."))) +
  geom_col(position = "stack") +
  scale_fill_manual(values = education_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total Reservations per Site Type Group"),
       y = "",
       title = paste0("Percentage of Reservations to Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = "none")

ggplotly(plot_education_site_type,
         tooltip = list("text"))
```

```{r}
# equestrian
data <- data_plot_education_site_type_equestrian
data_string <- deparse(substitute(data_plot_education_site_type_equestrian))

plot_education_site_type_equestrian <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = education)) +
  # geom_segment(aes(xend = 0, yend = education)) +
  geom_col(aes(x = percent_n,
               y = education,
               #color = education, 
               fill = education,
               text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", scales::percent(percent_n, accuracy = 0.1),
                             " of reservations were made by ",
                             "<br>people who live in ZIP codes with ", 
                             education, " as the highest level of education.")),
           # width = .25,
           # size = 4, shape = 21, stroke = 2
  ) +
  scale_fill_manual(values = education_group_colors) +
  scale_color_manual(values = education_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_education_site_type_equestrian,
         tooltip = list("text"))
```

```{r}
# remote
data <- data_plot_education_site_type_remote
data_string <- deparse(substitute(data_plot_education_site_type_remote))

plot_education_site_type_remote <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = education)) +
  # geom_segment(aes(xend = 0, yend = education)) +
  geom_col(aes(x = percent_n,
               y = education,
               #color = education, 
               fill = education,
               text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", scales::percent(percent_n, accuracy = 0.1),
                             " of reservations were made by ",
                             "<br>people who live in ZIP codes with ", 
                             education, " as the highest level of education.")),
           # width = .25,
           # size = 4, shape = 21, stroke = 2
  ) +
  scale_fill_manual(values = education_group_colors) +
  scale_color_manual(values = education_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_education_site_type_remote,
         tooltip = list("text"))
```

```{r}
# RV Only
data <- data_plot_education_site_type_rv.only
data_string <- deparse(substitute(data_plot_education_site_type_rv.only))

plot_education_site_type_rv_only <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = education)) +
  # geom_segment(aes(xend = 0, yend = education)) +
  geom_col(aes(x = percent_n,
               y = education,
               #color = education, 
               fill = education,
               text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", 
                             scales::percent(percent_n, accuracy = 0.1),
                             " of reservations were made by ",
                             "<br>people who live in ZIP codes with ", 
                             education, " as the highest level of education.")),
           # width = .25,
           # size = 4, shape = 21, stroke = 2
  ) +
  scale_fill_manual(values = education_group_colors) +
  scale_color_manual(values = education_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_education_site_type_rv_only,
         tooltip = list("text"))
```

```{r}
# RV or Tent
data <- data_plot_education_site_type_rv.or.tent
data_string <- deparse(substitute(data_plot_education_site_type_rv.or.tent))

plot_education_site_type_rv_or_tent <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = education)) +
  # geom_segment(aes(xend = 0, yend = education)) +
  geom_col(aes(x = percent_n,
               y = education,
               # color = education, 
               fill = education,
               text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", 
                             scales::percent(percent_n, accuracy = 0.1),
                             " of reservations were made by ",
                             "<br>people who live in ZIP codes with ", 
                             education, " as the highest level of education.")),
           # width = .25,
           # size = 4, shape = 21, stroke = 2
  ) +
  scale_fill_manual(values = education_group_colors) +
  scale_color_manual(values = education_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_education_site_type_rv_or_tent,
         tooltip = list("text"))
```

```{r}
# Shelter
data <- data_plot_education_site_type_shelter
data_string <- deparse(substitute(data_plot_education_site_type_shelter))

plot_education_site_type_shelter <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = education)) +
  # geom_segment(aes(xend = 0, yend = education)) +
  geom_col(aes(x = percent_n,
               y = education,
               # color = education, 
               fill = education,
               text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", 
                             scales::percent(percent_n, accuracy = 0.1),
                             " of reservations were made by ",
                             "<br>people who live in ZIP codes with ", 
                             education, " as the highest level of education.")),
           # width = .25,
           # size = 4, shape = 21, stroke = 2
  ) +
  scale_fill_manual(values = education_group_colors) +
  scale_color_manual(values = education_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_education_site_type_shelter,
         tooltip = list("text"))
```

```{r}
# Tent Only
data <- data_plot_education_site_type_tent.only
data_string <- deparse(substitute(data_plot_education_site_type_tent.only))

plot_education_site_type_tent_only <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = education)) +
  # geom_segment(aes(xend = 0, yend = education)) +
  geom_col(aes(x = percent_n,
               y = education,
               #color = education, 
               fill = education,
               text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", 
                             scales::percent(percent_n, accuracy = 0.1),
                             " of reservations were made by ",
                             "<br>people who live in ZIP codes with ", 
                             education, " as the highest level of education.")),
           # width = .25,
           # size = 4, shape = 21, stroke = 2
  ) +
  scale_fill_manual(values = education_group_colors) +
  scale_color_manual(values = education_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_education_site_type_tent_only,
         tooltip = list("text"))
```

```{r}
# Water
data <- data_plot_education_site_type_water
data_string <- deparse(substitute(data_plot_education_site_type_water))

plot_education_site_type_water <- ggplot(data = data, 
                                      aes(x = percent_n,
                                          y = education)) +
  # geom_segment(aes(xend = 0, yend = education)) +
  geom_col(aes(x = percent_n,
               y = education,
               #color = education, 
               fill = education,
               text = paste0("Of visits to ", aggregated_site_type, " overnight reservable sites, ", 
                             scales::percent(percent_n, accuracy = 0.1),
                             " of reservations were made by ",
                             "<br>people who live in ZIP codes with ", 
                             education, " as the highest level of education.")),
           # width = .25,
           # size = 4, shape = 21, stroke = 2
  ) +
  scale_fill_manual(values = education_group_colors) +
  scale_color_manual(values = education_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total", 
                 str_remove(string = data_string, pattern = ".*_") %>% 
                   str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                   str_to_title() %>% 
                   str_replace(string = ., pattern = "Rv", replacement = "RV"), 
                 "Reservations"),
       y = "",
       title = paste0("Percentage of Reservations to ", 
                      str_remove(string = data_string, pattern = ".*_") %>% 
                        str_replace_all(string = ., pattern = "\\.", replacement = " ") %>%  
                        str_to_title() %>% 
                        str_replace(string = ., pattern = "Rv", replacement = "RV"),
                      " Sites by <br>Different Racial Groups")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_education_site_type_water,
         tooltip = list("text"))
```


### Education x booking window 

```{r}
## -- data wrangle -- ##
education_groups <- c("hs_GED_or_below", "some_college", "college", "master_or_above")

data_plot_education_booking_window <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(education_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>%
    select(zip_code, hs_GED_or_below, some_college, college, master_or_above, mean_zip_code_population) %>%
    pivot_longer(cols = 2:5,
                 names_to = "education",
                 values_to = "education_percentage") %>%
    filter(education == education_groups[[i]]) %>% ## BACK TO i
    drop_na(education_percentage)

  weighted_half <- weighted.mean(x = df_ca_bin_breaks$education_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(education_percentage >= weighted_half)

  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$education_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_education_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, hs_GED_or_below, 
           some_college, college, master_or_above,  booking_window) %>% 
    drop_na(booking_window) %>% 
  pivot_longer(cols = 5:8,
               names_to = "education",
               values_to = "education_percentage") %>% 
    filter(education == education_groups[[i]]) %>% ## BACK TO i
    drop_na(education_percentage)

  max_education_group_ridb <- df_education_group_i_longer %>%
    summarize(max = max(education_percentage))

  df_education_group_i <- df_education_group_i_longer %>%
    filter(education_percentage >= weighted_quartile) %>% 
    summarize(mean_booking_window = mean(booking_window)) %>% 
    mutate(education = paste0(education_groups[[i]])) %>%  ## BACK TO i
    relocate(education, .before = 1) %>% 
    mutate(education = str_replace_all(string = education,
                                       pattern = "_",
                                       replacement = " "),
           education = str_to_title(education),
           education = str_replace(string = education,
                                   pattern = "Hs Ged Or", 
                                   replacement = "HS, GED, or"),
           education = str_replace(string = education,
                                   pattern = "Some College",
                                   replacement = "Some College or Trade School"),
           education = str_replace(string = education,
                                   pattern = "^College$",
                                   replacement = "Associates or Bachelors Degree"),
           education = str_replace(string = education,
                                   pattern = "Master Or Above",
                                   replacement = "Masters Degree or Above"))

  data_plot_education_booking_window <- rbind(data_plot_education_booking_window, df_education_group_i) %>% 
    mutate(education = factor(education, levels = c("HS, GED, or Below", "Some College or Trade School", 
                                                    "Associates or Bachelors Degree", "Masters Degree or Above")))
    
assign(paste0("top_quartile_ca_education_", education_groups[[i]]),
       c(weighted_quartile),
       envir = .GlobalEnv)
assign(paste0("max_education_ridb_", education_groups[[i]]),
       data.frame(max_education_group_ridb),
       envir = .GlobalEnv)
}


## -- create plot -- ##
education_group_colors <- c("HS, GED, or Below" = "#a6cee3", "Some College or Trade School"  = "#1f78b4", 
                      "Associates or Bachelors Degree" = "#b2df8a", "Masters Degree or Above" = "#33a02c")



# plot for shiny
plot_education_booking_window <- ggplot(data = data_plot_education_booking_window, 
                                      aes(x = mean_booking_window,
                                          y = reorder(education, mean_booking_window))) +
  geom_segment(aes(xend = 0, yend = education)) +
  geom_point(aes(x = mean_booking_window,
                 y = reorder(education, mean_booking_window),
                 color = education, fill = education,
                 text = paste("Those who live in ZIP codes with high rates of", 
                              education, "<br> as the maximum level of education tend to make their reservations<br>", round(mean_booking_window, 0), "days before their trip to overnight reservable sites.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = education_group_colors) +
  scale_color_manual(values = education_group_colors) +
  labs(x = paste("Average Number of Days from Order Date to Reservation Date"),
       y = "",
       title = "Average Number of Days in Advance Reservation is <br>Booked for Populations with Different Levels of Education") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_education_booking_window,
         tooltip = list("text"))
```


### Education x daily cost 

```{r}
## -- data wrangle -- ##
education_groups <- c("hs_GED_or_below", "some_college", "college", "master_or_above")

data_plot_education_daily_cost <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(education_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>%
    select(zip_code, hs_GED_or_below, some_college, college, master_or_above, mean_zip_code_population) %>%
    pivot_longer(cols = 2:5,
                 names_to = "education",
                 values_to = "education_percentage") %>%
    filter(education == education_groups[[i]]) %>% ## BACK TO i
    drop_na(education_percentage)

  weighted_half <- weighted.mean(x = df_ca_bin_breaks$education_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(education_percentage >= weighted_half)

  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$education_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_education_group_i_longer <- data_ridb_acs_2018 %>% 
    select(park, customer_zip, hs_GED_or_below, 
           some_college, college, master_or_above,  daily_cost) %>% 
    drop_na(daily_cost) %>% 
  pivot_longer(cols = 3:6,
               names_to = "education",
               values_to = "education_percentage") %>% 
    filter(education == education_groups[[i]]) %>% ## BACK TO i
    drop_na(education_percentage)

  max_education_group_ridb <- df_education_group_i_longer %>%
    summarize(max = max(education_percentage))

  df_education_group_i <- df_education_group_i_longer %>%
    filter(education_percentage >= weighted_quartile) %>% 
    summarize(mean_daily_cost = mean(daily_cost)) %>% 
    mutate(education = paste0(education_groups[[i]])) %>%  ## BACK TO i
    relocate(education, .before = 1) %>% 
    mutate(education = str_replace_all(string = education,
                                       pattern = "_",
                                       replacement = " "),
           education = str_to_title(education),
           education = str_replace(string = education,
                                   pattern = "Hs Ged Or", 
                                   replacement = "HS, GED, or"),
           education = str_replace(string = education,
                                   pattern = "Some College",
                                   replacement = "Some College or Trade School"),
           education = str_replace(string = education,
                                   pattern = "^College$",
                                   replacement = "Associates or Bachelors Degree"),
           education = str_replace(string = education,
                                   pattern = "Master Or Above",
                                   replacement = "Masters Degree or Above"))

  data_plot_education_daily_cost <- rbind(data_plot_education_daily_cost, df_education_group_i) %>% 
    mutate(education = factor(education, levels = c("HS, GED, or Below", "Some College or Trade School", 
                                                    "Associates or Bachelors Degree", "Masters Degree or Above")))
    
assign(paste0("top_quartile_ca_education_", education_groups[[i]]),
       c(weighted_quartile),
       envir = .GlobalEnv)
assign(paste0("max_education_ridb_", education_groups[[i]]),
       data.frame(max_education_group_ridb),
       envir = .GlobalEnv)
}


## -- create plot -- ##
education_group_colors <- c("HS, GED, or Below" = "#a6cee3", "Some College or Trade School"  = "#1f78b4", 
                      "Associates or Bachelors Degree" = "#b2df8a", "Masters Degree or Above" = "#33a02c")



# plot for shiny
plot_education_daily_cost <- ggplot(data = data_plot_education_daily_cost, 
                                      aes(x = mean_daily_cost,
                                          y = education)) +
  geom_segment(aes(xend = 0, yend = education)) +
  geom_point(aes(x = mean_daily_cost,
                 y = education,
                 color = education, fill = education,
                 text = paste("Those who live in ZIP codes with high rates of<br>", 
                              education, "as the highest level of education <br>pay an average of", scales::dollar(mean_daily_cost), "per day for overnight reservable sites.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = education_group_colors) +
  scale_color_manual(values = education_group_colors) +
  scale_x_continuous(labels = scales::dollar) +
  labs(x = paste("Average Daily Cost of Reservation"),
       y = "",
       title = "Average Daily Cost for Populations <br>with Different Levels of Education") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_education_daily_cost,
         tooltip = list("text"))
```


### Education x length of stay 

```{r}
education_groups <- c("hs_GED_or_below", "some_college", "college", "master_or_above")

data_plot_education_length_of_stay <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(education_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>%
    select(zip_code, hs_GED_or_below, some_college, college, master_or_above, mean_zip_code_population) %>%
    pivot_longer(cols = 2:5,
                 names_to = "education",
                 values_to = "education_percentage") %>%
    filter(education == education_groups[[i]]) %>% ## BACK TO i
    drop_na(education_percentage)

  weighted_half <- weighted.mean(x = df_ca_bin_breaks$education_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(education_percentage >= weighted_half)

  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$education_percentage, w = df_ca_bin_breaks$mean_zip_code_population)

  df_education_group_i_longer <- data_ridb_acs_2018 %>% 
    select(park, customer_zip, hs_GED_or_below, 
           some_college, college, master_or_above,  length_of_stay) %>% 
    drop_na(length_of_stay) %>% 
  pivot_longer(cols = 3:6,
               names_to = "education",
               values_to = "education_percentage") %>% 
    filter(education == education_groups[[i]]) %>% ## BACK TO i
    drop_na(education_percentage)

  max_education_group_ridb <- df_education_group_i_longer %>%
    summarize(max = max(education_percentage))

  df_education_group_i <- df_education_group_i_longer %>%
    filter(education_percentage >= weighted_quartile) %>% 
    summarize(mean_length_of_stay = mean(length_of_stay)) %>% 
    mutate(education = paste0(education_groups[[i]])) %>%  ## BACK TO i
    relocate(education, .before = 1) %>% 
    mutate(education = str_replace_all(string = education,
                                       pattern = "_",
                                       replacement = " "),
           education = str_to_title(education),
           education = str_replace(string = education,
                                   pattern = "Hs Ged Or", 
                                   replacement = "HS, GED, or"),
           education = str_replace(string = education,
                                   pattern = "Some College",
                                   replacement = "Some College or Trade School"),
           education = str_replace(string = education,
                                   pattern = "^College$",
                                   replacement = "Associates or Bachelors Degree"),
           education = str_replace(string = education,
                                   pattern = "Master Or Above",
                                   replacement = "Masters Degree or Above"))

  data_plot_education_length_of_stay <- rbind(data_plot_education_length_of_stay, df_education_group_i) %>% 
    mutate(education = factor(education, levels = c("HS, GED, or Below", "Some College or Trade School", 
                                                    "Associates or Bachelors Degree", "Masters Degree or Above")))
    
assign(paste0("top_quartile_ca_education_", education_groups[[i]]),
       c(weighted_quartile),
       envir = .GlobalEnv)
assign(paste0("max_education_ridb_", education_groups[[i]]),
       data.frame(max_education_group_ridb),
       envir = .GlobalEnv)
}


## -- create plot -- ##
education_group_colors <- c("HS, GED, or Below" = "#a6cee3", "Some College or Trade School"  = "#1f78b4", 
                      "Associates or Bachelors Degree" = "#b2df8a", "Masters Degree or Above" = "#33a02c")



# plot for shiny
plot_education_length_of_stay <- ggplot(data = data_plot_education_length_of_stay, 
                                      aes(x = mean_length_of_stay,
                                          y = education)) +
  geom_segment(aes(xend = 0, yend = education)) +
  geom_point(aes(x = mean_length_of_stay,
                 y = education,
                 color = education, fill = education,
                 text = paste("Those who live in ZIP codes with high rates of", 
                              education, "<br> as the highest level of education <br>stay an average of", round(mean_length_of_stay, 0), "days at overnight reservable sites.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = education_group_colors) +
  scale_color_manual(values = education_group_colors) +
  labs(x = paste("Average Length of Stay"),
       y = "",
       title = "Average Length of Stay for Populations <br>with Different Levels of Education") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_education_length_of_stay,
         tooltip = list("text"))
```




```{r}
# print "high" percentage range for each education level
print(paste0("A high presence was calculated as anything above the upper weighted quartile for each educational level group for the state of California."))
             
print(paste0("HS, GED, or below: ", round(top_quartile_ca_education_hs_GED_or_below, 4)*100, " - ", round(max_education_ridb_hs_GED_or_below, 4) *100, "%"))
             
print(paste0("Some Colleg: ", round(top_quartile_ca_education_some_college, 4)*100, " - ", round(max_education_ridb_some_college, 4) *100, "%"))
             
print(paste0("College Graduate: ", round(top_quartile_ca_education_college, 4)*100, " - ", round(max_education_ridb_college, 4) *100, "%"))
             
print(paste0("Masters Degree or Above: ", round(top_quartile_ca_education_master_or_above, 4)*100, " - ", round(max_education_ridb_master_or_above, 4) *100, "%"))
```

## Language x ____

### Language x distance traveled

```{r}
## -- data wrangle -- ##
language_groups <- c("english_only", "not_english_only")

data_plot_language_distance_traveled <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(language_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>% 
    select(zip_code, english_only, not_english_only, mean_zip_code_population) %>% 
    pivot_longer(cols = 2:3,
                 names_to = "language",
                 values_to = "language_percentage") %>% 
    filter(language == language_groups[[i]]) %>% ## BACK TO i
    drop_na(language_percentage) 
  
  weighted_half <- weighted.mean(x = df_ca_bin_breaks$language_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(language_percentage >= weighted_half)
  
  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$language_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_language_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, english_only, not_english_only,
           distance_traveled_m) %>% 
    mutate(distance_traveled_mi = distance_traveled_m * 0.000621371) %>% 
    drop_na(distance_traveled_mi) %>% 
  pivot_longer(cols = 5:6,
               names_to = "language",
               values_to = "language_percentage") %>% 
    filter(language == language_groups[[i]]) %>% ## BACK TO i
    drop_na(language_percentage)
  
  max_language_group_ridb <- df_language_group_i_longer %>%
    summarize(max = max(language_percentage))
  
  df_language_i_group <- df_language_group_i_longer %>% 
    filter(language_percentage >= weighted_quartile) %>% 
    summarize(mean_distance_traveled_mi = mean(distance_traveled_mi)) %>% 
    mutate(language = paste0(language_groups[[i]])) %>%  ## BACK TO i
    relocate(language, .before = 1) %>% 
    mutate(language = str_replace_all(string = language,
                                       pattern = "_",
                                       replacement = " "),
           language = str_replace(string = language,
                                  pattern = "^english only$",
                                  replacement = "Speak Only English at Home"),
           language = str_replace(string = language,
                                  pattern = "^not english only$",
                                  replacement = "Speak Language Other Than English at Home"),
           language = str_to_title(language))

  data_plot_language_distance_traveled <- rbind(data_plot_language_distance_traveled, df_language_i_group)
    
assign(paste0("top_quartile_ca_language_", language_groups[[i]]), 
       c(weighted_quartile), 
       envir = .GlobalEnv)
assign(paste0("max_language_ridb_", language_groups[[i]]), 
       data.frame(max_language_group_ridb), 
       envir = .GlobalEnv)
}


## -- create plot -- ##

language_group_colors <- c("Speak Only English At Home" = "#66c2a5", "Speak Language Other Than English At Home" = "#8da0cb")

plot_language_distance_traveled <- ggplot(data = data_plot_language_distance_traveled, 
                                      aes(x = mean_distance_traveled_mi,
                                          y = reorder(language, mean_distance_traveled_mi))) +
  geom_segment(aes(xend = 0, yend = reorder(language, mean_distance_traveled_mi))) +
  geom_point(aes(x = mean_distance_traveled_mi,
                 y = reorder(language, mean_distance_traveled_mi),
                 color = language, fill = language,
                 text = paste("Those who live in ZIP codes with high rates of <br>populations that", 
                              str_to_lower(language) %>% 
                                str_replace(string = ., pattern = "english", replacement = "English"), 
                              "<br>travel an estimated distance of", round(mean_distance_traveled_mi, 0), "miles to overnight reservable sites.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = language_group_colors) +
  scale_color_manual(values = language_group_colors) +
  labs(x = paste("Average Distance Traveled from Home to Site (miles)"),
       y = "",
       title = "Average Distance Traveled to Reservation for <br>Populations that Speak a Language Other than <br>English at Home") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_language_distance_traveled,
         tooltip = list("text"))
```


### Language x site type

```{r}
## -- data wrangle -- ##
language_groups <- c("english_only", "not_english_only")

site_types_groups <- c("equestrian", "remote", "rv only", "rv or tent", "shelter", "tent only", "water")

data_plot_language_site_type <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(language_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>% 
    select(zip_code, english_only, not_english_only, mean_zip_code_population) %>% 
    pivot_longer(cols = 2:3,
                 names_to = "language",
                 values_to = "language_percentage") %>% 
    filter(language == language_groups[[i]]) %>% ## BACK TO i
    drop_na(language_percentage) 
  
  weighted_half <- weighted.mean(x = df_ca_bin_breaks$language_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(language_percentage >= weighted_half)
  
  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$language_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_language_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, english_only, not_english_only, aggregated_site_type) %>% 
    drop_na(aggregated_site_type) %>% 
    pivot_longer(cols = 5:6,
                 names_to = "language",
                 values_to = "language_percentage") %>% 
    filter(language == language_groups[[i]]) %>% ## BACK TO i
    drop_na(language_percentage)

  max_language_group_ridb <- df_language_group_i_longer %>%
    summarize(max = max(language_percentage))

  df_language_group_i <- df_language_group_i_longer %>%
    filter(language_percentage >= weighted_quartile) %>% 
    count(language, aggregated_site_type) %>% 
    mutate(language = paste0(language_groups[[i]])) %>%  ## BACK TO i
    relocate(language, .before = 1) %>% 
    mutate(language = str_replace_all(string = language,
                              pattern = "_",
                              replacement = " "),
           language = str_replace(string = language,
                                  pattern = "^english only$",
                                  replacement = "Speak Only English at Home"),
           language = str_replace(string = language,
                                  pattern = "^not english only$",
                                  replacement = "Speak Language Other Than English at Home"),
           language = str_to_title(language))
  
  data_plot_language_site_type <- rbind(data_plot_language_site_type, df_language_group_i)
  
  for (j in seq_along(site_types_groups)){
    site_df <- data_plot_language_site_type %>% 
      filter(aggregated_site_type == site_types_groups[[j]]) %>% 
      mutate(sum_n = sum(n),
             percent_n = n / sum_n)
    
    assign(paste0("data_plot_language_site_type_", 
                  str_replace_all(string = site_types_groups[[j]],
                                  pattern = " ",
                                  replacement = ".")),
           data.frame(site_df), envir = .GlobalEnv)
  }

  assign(paste0("top_quartile_ca_language_", language_groups[[i]]),
         c(weighted_quartile),
         envir = .GlobalEnv)
  assign(paste0("max_language_ridb_", language_groups[[i]]),
         data.frame(max_language_group_ridb),
         envir = .GlobalEnv)
}


## -- create plot -- ##
language_group_colors <- c("Speak Only English At Home" = "#66c2a5", "Speak Language Other Than English At Home" = "#8da0cb")

# plot for shiny

# stacked all sites in one plot
data_plot_language_site_type <- rbind(data_plot_language_site_type_equestrian, data_plot_language_site_type_remote,
                                  data_plot_language_site_type_rv.only, data_plot_language_site_type_rv.or.tent,
                                  data_plot_language_site_type_shelter, data_plot_language_site_type_tent.only,
                                  data_plot_language_site_type_water) %>% 
  mutate(aggregated_site_type = str_to_title(string = aggregated_site_type) %>% 
           str_replace(string = ., pattern = "Rv", replacement = "RV"))

plot_language_site_type <- ggplot(data = data_plot_language_site_type, 
                              aes(x = percent_n,
                                  y = aggregated_site_type, fill = fct_rev(language),
                                  text = paste0("Of visits to ", aggregated_site_type, " sites, ", scales::percent(percent_n, accuracy = 0.1),
                                                " of reservations were made by ",
                                                "<br>people who live in ZIP codes with high rates of <br>households that ", 
                                                str_to_lower(language) %>% 
                                                  str_replace(string = ., pattern = "english", replacement = "English"), 
                                                "."))) +
  geom_col(position = "stack") +
  scale_fill_manual(values = language_group_colors) +
  scale_x_continuous(labels = scales::percent) +
  labs(x = paste("Percent of Total Reservations per Site Type Group"),
       y = "",
       title = paste0("Percentage of Reservations to Sites by <br>Language Spoken at Home")) + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        panel.grid.major.x = element_blank(),
        legend.position = "none")

ggplotly(plot_language_site_type,
         tooltip = list("text"))
```


### Language x booking window

```{r}
language_groups <- c("english_only", "not_english_only")

data_plot_language_booking_window <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(language_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>% 
    select(zip_code, english_only, not_english_only, mean_zip_code_population) %>% 
    pivot_longer(cols = 2:3,
                 names_to = "language",
                 values_to = "language_percentage") %>% 
    filter(language == language_groups[[i]]) %>% ## BACK TO i
    drop_na(language_percentage) 
  
  weighted_half <- weighted.mean(x = df_ca_bin_breaks$language_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(language_percentage >= weighted_half)
  
  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$language_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_language_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, english_only, not_english_only,
           booking_window) %>% 
    drop_na(booking_window) %>% 
  pivot_longer(cols = 5:6,
               names_to = "language",
               values_to = "language_percentage") %>% 
    filter(language == language_groups[[i]]) %>% ## BACK TO i
    drop_na(language_percentage)
  
  max_language_group_ridb <- df_language_group_i_longer %>%
    summarize(max = max(language_percentage))
  
  df_language_i_group <- df_language_group_i_longer %>% 
    filter(language_percentage >= weighted_quartile) %>% 
    summarize(mean_booking_window = mean(booking_window)) %>% 
    mutate(language = paste0(language_groups[[i]])) %>%  ## BACK TO i
    relocate(language, .before = 1) %>% 
    mutate(language = str_replace_all(string = language,
                                       pattern = "_",
                                       replacement = " "),
           language = str_replace(string = language,
                                  pattern = "^english only$",
                                  replacement = "Speak Only English at Home"),
           language = str_replace(string = language,
                                  pattern = "^not english only$",
                                  replacement = "Speak Language Other Than English at Home"),
           language = str_to_title(language))

  data_plot_language_booking_window <- rbind(data_plot_language_booking_window, df_language_i_group)
    
assign(paste0("top_quartile_ca_language_", language_groups[[i]]), 
       c(weighted_quartile), 
       envir = .GlobalEnv)
assign(paste0("max_language_ridb_", language_groups[[i]]), 
       data.frame(max_language_group_ridb), 
       envir = .GlobalEnv)
}


## -- create plot -- ##

language_group_colors <- c("Speak Only English At Home" = "#66c2a5", "Speak Language Other Than English At Home" = "#8da0cb")

plot_language_booking_window <- ggplot(data = data_plot_language_booking_window, 
                                      aes(x = mean_booking_window,
                                          y = reorder(language, mean_booking_window))) +
  geom_segment(aes(xend = 0, yend = reorder(language, mean_booking_window))) +
  geom_point(aes(x = mean_booking_window,
                 y = reorder(language, mean_booking_window),
                 color = language, fill = language,
                 text = paste("Those who live in ZIP codes with high rates of <br>populations that", 
                              str_to_lower(language) %>% 
                                str_replace(string = ., pattern = "english", replacement = "English"), 
                              "<br>make their reservations", round(mean_booking_window, 0), 
                              "days before their trip to overnight reservable sites.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = language_group_colors) +
  scale_color_manual(values = language_group_colors) +
  labs(x = paste("Average Number of Days from Order Date to Reservation Date"),
       y = "",
       title = "Average Number of Days from Order to Reservation Date <br>for Populations Based on Languages Spoken at Home") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_language_booking_window,
         tooltip = list("text"))
```



### Language x daily cost

```{r}
## -- data wrangle -- ##
language_groups <- c("english_only", "not_english_only")

data_plot_language_daily_cost <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(language_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>% 
    select(zip_code, english_only, not_english_only, mean_zip_code_population) %>% 
    pivot_longer(cols = 2:3,
                 names_to = "language",
                 values_to = "language_percentage") %>% 
    filter(language == language_groups[[i]]) %>% ## BACK TO i
    drop_na(language_percentage) 
  
  weighted_half <- weighted.mean(x = df_ca_bin_breaks$language_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(language_percentage >= weighted_half)
  
  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$language_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_language_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, english_only, not_english_only,
           daily_cost) %>% 
    drop_na(daily_cost) %>% 
  pivot_longer(cols = 5:6,
               names_to = "language",
               values_to = "language_percentage") %>% 
    filter(language == language_groups[[i]]) %>% ## BACK TO i
    drop_na(language_percentage)
  
  max_language_group_ridb <- df_language_group_i_longer %>%
    summarize(max = max(language_percentage))
  
  df_language_i_group <- df_language_group_i_longer %>% 
    filter(language_percentage >= weighted_quartile) %>% 
    summarize(mean_daily_cost = mean(daily_cost)) %>% 
    mutate(language = paste0(language_groups[[i]])) %>%  ## BACK TO i
    relocate(language, .before = 1) %>% 
    mutate(language = str_replace_all(string = language,
                                       pattern = "_",
                                       replacement = " "),
           language = str_replace(string = language,
                                  pattern = "^english only$",
                                  replacement = "Speak Only English at Home"),
           language = str_replace(string = language,
                                  pattern = "^not english only$",
                                  replacement = "Speak Language Other Than English at Home"),
           language = str_to_title(language))

  data_plot_language_daily_cost <- rbind(data_plot_language_daily_cost, df_language_i_group)
    
assign(paste0("top_quartile_ca_language_", language_groups[[i]]), 
       c(weighted_quartile), 
       envir = .GlobalEnv)
assign(paste0("max_language_ridb_", language_groups[[i]]), 
       data.frame(max_language_group_ridb), 
       envir = .GlobalEnv)
}


## -- create plot -- ##

language_group_colors <- c("Speak Only English At Home" = "#66c2a5", "Speak Language Other Than English At Home" = "#8da0cb")

plot_language_daily_cost <- ggplot(data = data_plot_language_daily_cost, 
                                      aes(x = mean_daily_cost,
                                          y = reorder(language, mean_daily_cost))) +
  geom_segment(aes(xend = 0, yend = reorder(language, mean_daily_cost))) +
  geom_point(aes(x = mean_daily_cost,
                 y = reorder(language, mean_daily_cost),
                 color = language, fill = language,
                 text = paste("Those who live in ZIP codes with high rates of <br>populations that", 
                              str_to_lower(language) %>% 
                                str_replace(string = ., pattern = "english", replacement = "English"), 
                              "<br>pay an average of", scales::dollar(mean_daily_cost), 
                              "per day for overnight reservable sites.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = language_group_colors) +
  scale_color_manual(values = language_group_colors) +
  scale_x_continuous(labels = scales::dollar) +
  labs(x = paste("Average Daily Cost of Reservation"),
       y = "",
       title = "Average Daily Cost of Reservations for <br>Populations that Speak a Language Other than <br>English at Home") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_language_daily_cost,
         tooltip = list("text"))
```


### Language x length of stay

```{r}
## -- data wrangle -- ##
language_groups <- c("english_only", "not_english_only")

data_plot_language_length_of_stay <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(language_groups)){
  df_ca_bin_breaks <- data_ca_acs_2018 %>% 
    select(zip_code, english_only, not_english_only, mean_zip_code_population) %>% 
    pivot_longer(cols = 2:3,
                 names_to = "language",
                 values_to = "language_percentage") %>% 
    filter(language == language_groups[[i]]) %>% ## BACK TO i
    drop_na(language_percentage) 
  
  weighted_half <- weighted.mean(x = df_ca_bin_breaks$language_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(language_percentage >= weighted_half)
  
  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$language_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_language_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, english_only, not_english_only,
           length_of_stay) %>% 
    drop_na(length_of_stay) %>% 
  pivot_longer(cols = 5:6,
               names_to = "language",
               values_to = "language_percentage") %>% 
    filter(language == language_groups[[i]]) %>% ## BACK TO i
    drop_na(language_percentage)
  
  max_language_group_ridb <- df_language_group_i_longer %>%
    summarize(max = max(language_percentage))
  
  df_language_i_group <- df_language_group_i_longer %>% 
    filter(language_percentage >= weighted_quartile) %>% 
    summarize(mean_length_of_stay = mean(length_of_stay)) %>% 
    mutate(language = paste0(language_groups[[i]])) %>%  ## BACK TO i
    relocate(language, .before = 1) %>% 
    mutate(language = str_replace_all(string = language,
                                       pattern = "_",
                                       replacement = " "),
           language = str_replace(string = language,
                                  pattern = "^english only$",
                                  replacement = "Speak Only English at Home"),
           language = str_replace(string = language,
                                  pattern = "^not english only$",
                                  replacement = "Speak Language Other Than English at Home"),
           language = str_to_title(language))

  data_plot_language_length_of_stay <- rbind(data_plot_language_length_of_stay, df_language_i_group)
    
assign(paste0("top_quartile_ca_language_", language_groups[[i]]), 
       c(weighted_quartile), 
       envir = .GlobalEnv)
assign(paste0("max_language_ridb_", language_groups[[i]]), 
       data.frame(max_language_group_ridb), 
       envir = .GlobalEnv)
}


## -- create plot -- ##

language_group_colors <- c("Speak Only English At Home" = "#66c2a5", "Speak Language Other Than English At Home" = "#8da0cb")

plot_language_length_of_stay <- ggplot(data = data_plot_language_length_of_stay, 
                                      aes(x = mean_length_of_stay,
                                          y = language)) +
  geom_segment(aes(xend = 0, yend = language)) +
  geom_point(aes(x = mean_length_of_stay,
                 y = language,
                 color = language, fill = language,
                 text = paste("Those who live in ZIP codes with high rates of <br>populations that", 
                              str_to_lower(language) %>% 
                                str_replace(string = ., pattern = "english", replacement = "English"), 
                              "<br>stay an average of", round(mean_length_of_stay, 0), 
                              "days at overnight reservable sites.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  scale_fill_manual(values = language_group_colors) +
  scale_color_manual(values = language_group_colors) +
  labs(x = paste("Average Length of Stay"),
       y = "",
       title = "Average Length of Stay of Reservations for <br>Populations that Speak a Language Other than <br>English at Home") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_language_length_of_stay,
         tooltip = list("text"))
```



```{r}
# print "high" percentage range for each language category
print(paste0("A high presence was calculated as anything above the upper weighted quartile for each language group for the state of California."))
             
print(paste0("Speak Only English at Home: ", percent(top_quartile_ca_language_english_only, accuracy = 0.1), 
             " - ", percent(max_language_ridb_english_only[[1]], accuracy = 0.1), "%"))
             
print(paste0("Language(s) Other than English: ", percent(top_quartile_ca_language_not_english_only, accuracy = 0.1), 
             " - ", percent(max_language_ridb_not_english_only[[1]], accuracy = 0.1), "%"))
```



## Median-income x ____

### Median-income x distance traveled

```{r}
## -- data wrangle -- ##



## -- create plot -- ##


```


### Median-income x site type

### Median-income x daily cost

### Median-income x lenth of stay



## Booking window x site type

```{r}
## -- data wrangle -- ##
data_plot_booking_window_site_type <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, aggregated_site_type, booking_window) %>% 
  group_by(aggregated_site_type) %>% 
  summarise(mean_booking_window = mean(booking_window, na.rm = TRUE)) %>% 
  mutate(aggregated_site_type = str_to_title(aggregated_site_type),
         aggregated_site_type = str_replace(string = aggregated_site_type,
                                            pattern = "Rv",
                                            replacement = "RV"))



## -- create plot -- ##
plot_booking_window_site_type <- ggplot(data = data_plot_booking_window_site_type, 
                                      aes(x = mean_booking_window,
                                          y = reorder(aggregated_site_type, mean_booking_window))) +
  geom_segment(aes(xend = 0, yend = reorder(aggregated_site_type, mean_booking_window))) +
  geom_point(aes(x = mean_booking_window,
                 y = reorder(aggregated_site_type, mean_booking_window),
                 color = aggregated_site_type, fill = aggregated_site_type,
                 text = paste("Those who visit", aggregated_site_type, "tend to reserve their overnight reservable site<br>", 
                              round(mean_booking_window, 0), "days before their trip start date.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  labs(x = paste("Average Number of Days from Order Date to Reservation Date"),
       y = "",
       title = "Average Length of Stay of Reservations for <br>Different Site Types") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_booking_window_site_type,
         tooltip = list("text"))
```



## Booking window x distance traveled

```{r}
## -- data wrangle -- ##
data_plot_booking_window_site_type <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, aggregated_site_type, distance_traveled_m)%>% 
  mutate(distance_traveled_mi = distance_traveled_m * 0.000621371) %>% 
  group_by(aggregated_site_type) %>% 
  summarise(mean_distance_traveled_mi = mean(distance_traveled_mi, na.rm = TRUE)) %>% 
  mutate(aggregated_site_type = str_to_title(aggregated_site_type),
         aggregated_site_type = str_replace(string = aggregated_site_type,
                                            pattern = "Rv",
                                            replacement = "RV"))



## -- create plot -- ##
plot_booking_window_site_type <- ggplot(data = data_plot_booking_window_site_type, 
                                      aes(x = mean_distance_traveled_mi,
                                          y = reorder(aggregated_site_type, mean_distance_traveled_mi))) +
  geom_segment(aes(xend = 0, yend = reorder(aggregated_site_type, mean_distance_traveled_mi))) +
  geom_point(aes(x = mean_distance_traveled_mi,
                 y = reorder(aggregated_site_type, mean_distance_traveled_mi),
                 color = aggregated_site_type, fill = aggregated_site_type,
                 text = paste("Those who visit", aggregated_site_type, "overnight reservable sites tend to travel", 
                              round(mean_distance_traveled_mi, 0), "miles.")),
             width = .25,
             size = 4, shape = 21, stroke = 2) +
  labs(x = paste("Average Distance Traveled from Home to Site (miles)"),
       y = "",
       title = "Average Distance Traveled to Site for <br>Different Site Types") + 
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        legend.position = "none")

ggplotly(plot_booking_window_site_type,
         tooltip = list("text"))
```



```{r, eval=TRUE}
end_time <- Sys.time()
time_taken <- end_time - start_time
time_taken
```

