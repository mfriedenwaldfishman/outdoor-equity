---
title: "Data Viz for Shiny App"
author: "Clarissa"
date: "3/17/2022"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(sf)
library(tidycensus)
library(patchwork)
library(scales)
library(tmap)
library(vroom)
library(paletteer)
library(ggridges)
library(plotly)

options(scipen = 999)
```


```{r}
start_time <- Sys.time()
```


```{r load data}
# read in joined data
data_ridb_acs_2018 <- vroom(file = "../../../../data_clean/2018_joined_data.csv",
                            delim = ",") ## non-map graphs (no geometries)
# data_ridb_acs_2018 <- readRDS(file = "../../../../data_clean/2018_joined_data.rds") ## maps (don't use RDS for non-map viz, too slow)

data_ca_acs_2018 <- vroom(file = "../../../../data_clean/2018_ca_acs_all.csv",
                          delim = ",")
```


## Agency Analysis: Comparison Graphs

### Race x distance traveled 

#### (Option 1)

```{r}
## -- data wrangle -- ##
data_plot_race_distance_traveled_bins <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, customer_zip, asian, black, hispanic_latinx, 
         multiracial, native_american, other, pacific_islander, white,
         distance_traveled_m) %>% 
  mutate(distance_traveled_mi = distance_traveled_m * 0.000621371) %>% 
  drop_na(distance_traveled_mi) %>% 
  mutate(distance_traveled_bins = ntile(distance_traveled_mi, 5)) 

distance_traveled_bin_breaks <- quantile(data_plot_race_distance_traveled_bins$distance_traveled_mi, 
                                         prob = seq(0, 1, length = 6), type = 5)

data_plot_race_distance_traveled <- data_plot_race_distance_traveled_bins %>% 
  group_by(distance_traveled_bins) %>% 
  summarize(white = (mean(white, na.rm = TRUE) * 100),
            black = (mean(black, na.rm = TRUE) * 100),
            asian = (mean(asian, na.rm = TRUE) * 100),
            multiracial = (mean(multiracial, na.rm = TRUE) * 100),
            other = (mean(other, na.rm = TRUE) * 100),
            native_american = (mean(native_american, na.rm = TRUE) * 100),
            pacific_islander = (mean(pacific_islander, na.rm = TRUE) * 100),
            hispanic_latinx = (mean(hispanic_latinx, na.rm = TRUE) * 100)) %>% 
  pivot_longer(cols = 2:9,
               names_to = "race",
               values_to = "race_percentage") %>% 
  mutate(race = str_replace(string = race,
                            pattern = "_",
                            replacement = " "),
         race = str_to_title(race)) %>% 
  mutate(distance_traveled_bins = case_when(distance_traveled_bins == 1 ~ paste0(round(distance_traveled_bin_breaks, 0)[[1]], 
                                                                                 " - ",
                                                                                 round(distance_traveled_bin_breaks, 0)[[2]],
                                                                                 " mi"), 
                                            distance_traveled_bins == 2 ~ paste0(round(distance_traveled_bin_breaks, 0)[[2]], 
                                                                                 " - ",
                                                                                 round(distance_traveled_bin_breaks, 0)[[3]],
                                                                                 " mi"), 
                                            distance_traveled_bins == 3 ~ paste0(round(distance_traveled_bin_breaks, 0)[[3]], 
                                                                                 " - ",
                                                                                 round(distance_traveled_bin_breaks, 0)[[4]],
                                                                                 " mi"), 
                                            distance_traveled_bins == 4 ~ paste0(round(distance_traveled_bin_breaks, 0)[[4]], 
                                                                                 " - ",
                                                                                 round(distance_traveled_bin_breaks, 0)[[5]],
                                                                                 " mi"), 
                                            distance_traveled_bins == 5 ~ paste0(round(distance_traveled_bin_breaks, 0)[[5]], 
                                                                                 " - ",
                                                                                 round(distance_traveled_bin_breaks, 0)[[6]],
                                                                                 " mi")), 
         distance_traveled_bins = factor(distance_traveled_bins, levels = c(
           paste0(round(distance_traveled_bin_breaks, 0)[[1]], " - ", round(distance_traveled_bin_breaks, 0)[[2]], " mi"), 
           paste0(round(distance_traveled_bin_breaks, 0)[[2]], " - ", round(distance_traveled_bin_breaks, 0)[[3]], " mi"),
           paste0(round(distance_traveled_bin_breaks, 0)[[3]], " - ", round(distance_traveled_bin_breaks, 0)[[4]], " mi"),
           paste0(round(distance_traveled_bin_breaks, 0)[[4]], " - ", round(distance_traveled_bin_breaks, 0)[[5]], " mi"),
           paste0(round(distance_traveled_bin_breaks, 0)[[5]], " - ", round(distance_traveled_bin_breaks, 0)[[6]], " mi"))))
  

## -- create plot -- ##

# parameters
racial_group_colors <- c("Other" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")

# plot for shiny
plot_race_distance_traveled <- ggplot(data = data_plot_race_distance_traveled) +
  geom_col(aes(x = distance_traveled_bins,
               y = race_percentage,
               fill = race,
               text = paste0("Reservations that traveled from ", distance_traveled_bins, 
                             "<br> live in communities with ", round(race_percentage, 2), "% ", race, " folks on average.")
           )) +
  facet_wrap(~race, scales = "free_x") +
  scale_fill_manual(values = racial_group_colors) +
  labs(x = "Distance Traveled (miles)",
       y = "Percentage (%)",
       title = "Distance Traveled Compared to Racial Breakdown of Home",
       subtitle = "for Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.x = element_blank()) +
  coord_flip()

ggplotly(plot_race_distance_traveled,
         tooltip = list("text"))
```

#### (Option 2.1)

```{r, fig.width=5, fig.height=3}
## -- data wrangle -- ##
data_plot_race_distance_traveled_2 <- data_plot_race_distance_traveled_bins %>% 
  select(asian, black, hispanic_latinx, multiracial, native_american, 
         other, pacific_islander, white, distance_traveled_bins) %>% 
  pivot_longer(cols = 1:8,
               names_to = "race",
               values_to = "race_percentage") %>% 
  mutate(race = str_replace(string = race,
                            pattern = "_",
                            replacement = " "),
         race = str_to_title(race)) %>% 
  filter(!is.na(race_percentage))


## -- create plot -- ##

# plot_race_distance_traveled_2 <- function(data, race, breaks, x_major, x_minor){
#   ggplot(data = data) +
#     geom_boxplot(aes(x = factor(distance_traveled_bins),
#                      y = race_percentage * 100,
#                      fill = race),
#                  varwidth = TRUE, outlier.shape = NA) +
#     coord_flip() +
#     scale_fill_manual(values = racial_group_colors) +
#     scale_x_discrete(labels = c("1" = "0 - 60 mi",
#                                 "2" = "60 - 117 mi",
#                                 "3" = "117 - 181 mi",
#                                 "4" = "181 - 299 mi",
#                                 "5" = "299 - 3,614 mi")) +
#     scale_y_continuous(limits = c(0, breaks),
#                        breaks = seq(0, breaks, x_major),
#                        minor_breaks = seq(0, breaks, x_minor),
#                        sec.axis = dup_axis()) +
#     labs(x = "Distance Traveled (miles)",
#          y = "Percentage (%)",
#          title = paste(race),
#          subtitle = "Race of Home ZIP Codes \nvs. Distance Traveled \nfor Overnight Reservations in California") +
#     theme_minimal() +
#     theme(legend.position = "none",
#           plot.background = element_rect("white"),
#           panel.grid.major.y = element_blank())
# }
# 
# races <- c("Asian", "Black"#, "Hispanic Latinx",
#            # "Multiracial", "Native American", "Other",
#            # "Pacific Islander", "White"
#            )
# 
# for (i in seq_along(races)){
# 
#   data <- data_plot_race_distance_traveled_2 %>%
#              filter(race == paste(races[[i]]))
# 
#   print(plot_race_distance_traveled_2(race = races[[i]], data = data,
#                                       breaks = 60, x_major = 10, x_minor = 5))
# }

test_plot_asian <- 
  ggplot(data = data_plot_race_distance_traveled_2 %>% filter(race == "Asian")) +
  geom_boxplot(aes(x = factor(distance_traveled_bins),
                   y = race_percentage * 100, 
                   fill = race),
               varwidth = TRUE, outlier.shape = NA) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_discrete(labels = c("1" = "0 - 60.2 miles", "2" = "60.2 - 116.9 miles", "3" = "116.9 - 180.9 miles",
                              "4" = "180.9 - 299.3 miles", "5" = "299.3 - 3,613.7 miles")) +
  scale_y_continuous(limits = c(0, 60),
                     breaks = seq(0, 60, 10),
                     minor_breaks = seq(0, 60, 5),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       y = "Percentage (%)",
       title = "Asian",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()) +
  coord_flip()
test_plot_asian

test_plot_black <- 
  ggplot(data = data_plot_race_distance_traveled_2 %>% filter(race == "Black")) +
  geom_boxplot(aes(x = factor(distance_traveled_bins),
                   y = race_percentage * 100, 
                   fill = race),
               varwidth = TRUE, outlier.shape = NA) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_discrete(labels = c("1" = "0 - 60.2 miles", "2" = "60.2 - 116.9 miles", "3" = "116.9 - 180.9 miles",
                              "4" = "180.9 - 299.3 miles", "5" = "299.3 - 3,613.7 miles")) +
  scale_y_continuous(limits = c(0, 25),
                     breaks = seq(0, 25, 5),
                     minor_breaks = seq(0, 25, 1),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       y = "Percentage (%)",
       title = "Black",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()) +
  coord_flip()
test_plot_black

test_plot_latinx <- 
  ggplot(data = data_plot_race_distance_traveled_2 %>% filter(race == "Hispanic Latinx")) +
  geom_boxplot(aes(x = factor(distance_traveled_bins),
                   y = race_percentage * 100, 
                   fill = race),
               varwidth = TRUE, outlier.shape = NA) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_discrete(labels = c("1" = "0 - 60.2 miles", "2" = "60.2 - 116.9 miles", "3" = "116.9 - 180.9 miles",
                              "4" = "180.9 - 299.3 miles", "5" = "299.3 - 3,613.7 miles")) +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(0, 100, 10),
                     minor_breaks = seq(0, 100, 5),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       y = "Percentage (%)",
       title = "Hispanic Latinx",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()) +
  coord_flip()
test_plot_latinx

test_plot_multi <- 
  ggplot(data = data_plot_race_distance_traveled_2 %>% filter(race == "Multiracial")) +
  geom_boxplot(aes(x = factor(distance_traveled_bins),
                   y = race_percentage * 100, 
                   fill = race),
               varwidth = TRUE, outlier.shape = NA) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_discrete(labels = c("1" = "0 - 60.2 miles", "2" = "60.2 - 116.9 miles", "3" = "116.9 - 180.9 miles",
                              "4" = "180.9 - 299.3 miles", "5" = "299.3 - 3,613.7 miles")) +
  scale_y_continuous(limits = c(0, 10),
                     breaks = seq(0, 10, 1),
                     minor_breaks = seq(0, 10, 0.5),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       y = "Percentage (%)",
       title = "Multiracial",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()) +
  coord_flip()
test_plot_multi

test_plot_native_amer <- 
  ggplot(data = data_plot_race_distance_traveled_2 %>% filter(race == "Native American")) +
  geom_boxplot(aes(x = factor(distance_traveled_bins),
                   y = race_percentage * 100, 
                   fill = race),
               varwidth = TRUE, outlier.shape = NA) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_discrete(labels = c("1" = "0 - 60.2 miles", "2" = "60.2 - 116.9 miles", "3" = "116.9 - 180.9 miles",
                              "4" = "180.9 - 299.3 miles", "5" = "299.3 - 3,613.7 miles")) +
  scale_y_continuous(limits = c(0, 2),
                     breaks = seq(0, 2, 0.5),
                     minor_breaks = seq(0, 2, 0.25),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       y = "Percentage (%)",
       title = "Native America",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()) +
  coord_flip()
test_plot_native_amer

test_plot_other <- 
  ggplot(data = data_plot_race_distance_traveled_2 %>% filter(race == "Other")) +
  geom_boxplot(aes(x = factor(distance_traveled_bins),
                   y = race_percentage * 100, 
                   fill = race),
               varwidth = TRUE, outlier.shape = NA) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_discrete(labels = c("1" = "0 - 60.2 miles", "2" = "60.2 - 116.9 miles", "3" = "116.9 - 180.9 miles",
                              "4" = "180.9 - 299.3 miles", "5" = "299.3 - 3,613.7 miles")) +
  scale_y_continuous(limits = c(0, 1.2),
                     breaks = seq(0, 1.2, 0.2),
                     minor_breaks = seq(0, 1.2, 0.1),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       y = "Percentage (%)",
       title = "Other",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()) +
  coord_flip()
test_plot_other

test_plot_pac_islander <- 
  ggplot(data = data_plot_race_distance_traveled_2 %>% filter(race == "Pacific Islander")) +
  geom_boxplot(aes(x = factor(distance_traveled_bins),
                   y = race_percentage * 100, 
                   fill = race),
               varwidth = TRUE, outlier.shape = NA) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_discrete(labels = c("1" = "0 - 60.2 miles", "2" = "60.2 - 116.9 miles", "3" = "116.9 - 180.9 miles",
                              "4" = "180.9 - 299.3 miles", "5" = "299.3 - 3,613.7 miles")) +
  scale_y_continuous(limits = c(0, 1.2),
                     breaks = seq(0, 1.2, 0.2),
                     minor_breaks = seq(0, 1.2, 0.1),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       y = "Percentage (%)",
       title = "Pacific Islander",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()) +
  coord_flip()
test_plot_pac_islander

test_plot_white <- 
  ggplot(data = data_plot_race_distance_traveled_2 %>% filter(race == "White")) +
  geom_boxplot(aes(x = factor(distance_traveled_bins),
                   y = race_percentage * 100, 
                   fill = race),
               varwidth = TRUE, outlier.shape = NA) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_discrete(labels = c("1" = "0 - 60.2 miles", "2" = "60.2 - 116.9 miles", "3" = "116.9 - 180.9 miles",
                              "4" = "180.9 - 299.3 miles", "5" = "299.3 - 3,613.7 miles")) +
  scale_y_continuous(limits = c(0, 100),
                     breaks = seq(0, 100, 10),
                     minor_breaks = seq(0, 100, 5),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       y = "Percentage (%)",
       title = "White",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()) +
  coord_flip()
test_plot_white

## try binning by racial percentage (y axis) and have the boxplot show distribution of distnace traveled (x axis)
```


#### (Option 2.2)

```{r}
## try binning by racial percentage (y axis) and have the boxplot show distribution of distnace traveled (x axis)

## -- data wrangle -- ##
data_ca_acs_2018_average <- data_ca_acs_2018 %>% 
  select(zip_code, asian, black, hispanic_latinx, 
         multiracial, native_american, other, pacific_islander, white) %>% 
  summarise(asian = mean(asian, na.rm = TRUE),
            black = mean(black, na.rm = TRUE),
            hispanic_latinx = mean(hispanic_latinx, na.rm = TRUE), 
            multiracial = mean(multiracial, na.rm = TRUE),
            native_american = mean(native_american, na.rm = TRUE),
            other = mean(other, na.rm = TRUE),
            pacific_islander = mean(pacific_islander, na.rm = TRUE),
            white = mean(white, na.rm = TRUE)) %>% 
  pivot_longer(cols = 1:8,
               names_to = "race",
               values_to = "ca_race_mean")

test_race_bins <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, customer_zip, asian, black, hispanic_latinx, 
         multiracial, native_american, other, pacific_islander, white,
         distance_traveled_m) %>% 
  mutate(distance_traveled_mi = distance_traveled_m * 0.000621371) %>% 
  drop_na(distance_traveled_mi) %>% 
  pivot_longer(5:12,
               names_to = "race",
               values_to = "race_percentage") %>% 
  left_join(y = data_ca_acs_2018_average,
            by = "race") %>% 
  mutate(above_race_average = case_when(race_percentage > ca_race_mean ~ 1,
                                        race_percentage < ca_race_mean ~ 0)) %>% 
  mutate(race = str_replace(string = race,
                            pattern = "_",
                            replacement = " "),
         race = str_to_title(race)) %>% 
  drop_na(race_percentage, above_race_average)

racial_groups <- c("Other", "Pacific Islander", "Multiracial", "Asian", 
                   "Black", "White", "Native American", "Hispanic Latinx")
racial_groups_names <- c("other", "pacific_islander", "multiracial", "asian", 
                   "black", "white", "native_american", "hispanic_latinx")

for (i in seq_along(racial_groups)){
  df <- test_race_bins %>% filter(race == racial_groups[[i]])
  for (j in seq_along(racial_groups_names)) {
  assign(paste0("test_race_", racial_groups_names[[i]]), data.frame(df), envir = .GlobalEnv)
  }
}

# parameters
racial_group_colors <- c("Other" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")

## -- create plot -- ##
# asian
ggplot(data = test_race_asian) +
  geom_boxplot(aes(x = factor(above_race_average),
                   y = distance_traveled_mi,
                   fill = race),
               varwidth = TRUE, 
               outlier.shape = NA
               ) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) + 
  scale_x_discrete(labels = c("1" = "Above CA Average", "0" = "Below CA Average")) +
  scale_y_continuous(limits = c(0, 1000),
                     breaks = seq(0, 1000, 100),
                     minor_breaks = seq(0, 1000, 50),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       #y = "Percentage (%)",
       title = "Asian",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank())

# black
ggplot(data = test_race_black) +
  geom_boxplot(aes(x = factor(above_race_average),
                   y = distance_traveled_mi,
                   fill = race),
               varwidth = TRUE, 
               outlier.shape = NA
               ) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) + 
  scale_x_discrete(labels = c("1" = "Above CA Average", "0" = "Below CA Average")) +
  scale_y_continuous(limits = c(0, 800),
                     breaks = seq(0, 800, 100),
                     minor_breaks = seq(0, 800, 50),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       #y = "Percentage (%)",
       title = "Black",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank())


# hispanic_latinx
ggplot(data = test_race_hispanic_latinx) +
  geom_boxplot(aes(x = factor(above_race_average),
                   y = distance_traveled_mi,
                   fill = race),
               varwidth = TRUE, 
               outlier.shape = NA
               ) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) + 
  scale_x_discrete(labels = c("1" = "Above CA Average", "0" = "Below CA Average")) +
  scale_y_continuous(limits = c(0, 700),
                     breaks = seq(0, 700, 100),
                     minor_breaks = seq(0, 700, 50),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       #y = "Percentage (%)",
       title = "Hispanic Latinx",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank())

# multiracial
ggplot(data = test_race_multiracial) +
  geom_boxplot(aes(x = factor(above_race_average),
                   y = distance_traveled_mi,
                   fill = race),
               varwidth = TRUE, 
               outlier.shape = NA
               ) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) + 
  scale_x_discrete(labels = c("1" = "Above CA Average", "0" = "Below CA Average")) +
  scale_y_continuous(limits = c(0, 800),
                     breaks = seq(0, 800, 100),
                     minor_breaks = seq(0, 800, 50),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       #y = "Percentage (%)",
       title = "Multiracial",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank())

# native_american
ggplot(data = test_race_native_american) +
  geom_boxplot(aes(x = factor(above_race_average),
                   y = distance_traveled_mi,
                   fill = race),
               varwidth = TRUE, 
               outlier.shape = NA
               ) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) + 
  scale_x_discrete(labels = c("1" = "Above CA Average", "0" = "Below CA Average")) +
  scale_y_continuous(limits = c(0, 1000),
                     breaks = seq(0, 1000, 100),
                     minor_breaks = seq(0, 1000, 50),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       #y = "Percentage (%)",
       title = "Native American",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank())

# other
ggplot(data = test_race_other) +
  geom_boxplot(aes(x = factor(above_race_average),
                   y = distance_traveled_mi,
                   fill = race),
               varwidth = TRUE, 
               outlier.shape = NA
               ) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) + 
  scale_x_discrete(labels = c("1" = "Above CA Average", "0" = "Below CA Average")) +
  scale_y_continuous(limits = c(0, 700),
                     breaks = seq(0, 700, 100),
                     minor_breaks = seq(0, 700, 50),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       #y = "Percentage (%)",
       title = "Other Race or Races",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank())

# pacific_islander
ggplot(data = test_race_pacific_islander) +
  geom_boxplot(aes(x = factor(above_race_average),
                   y = distance_traveled_mi,
                   fill = race),
               varwidth = TRUE, 
               outlier.shape = NA
               ) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) + 
  scale_x_discrete(labels = c("1" = "Above CA Average", "0" = "Below CA Average")) +
  scale_y_continuous(limits = c(0, 700),
                     breaks = seq(0, 700, 100),
                     minor_breaks = seq(0, 700, 50),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       #y = "Percentage (%)",
       title = "Pacific Islander",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank())

# white
ggplot(data = test_race_white) +
  geom_boxplot(aes(x = factor(above_race_average),
                   y = distance_traveled_mi,
                   fill = race),
               varwidth = TRUE, 
               outlier.shape = NA
               ) +
  coord_flip() +
  scale_fill_manual(values = racial_group_colors) + 
  scale_x_discrete(labels = c("1" = "Above CA Average", "0" = "Below CA Average")) +
  scale_y_continuous(limits = c(0, 900),
                     breaks = seq(0, 900, 100),
                     minor_breaks = seq(0, 900, 50),
                     sec.axis = dup_axis()) +
  labs(x = "Distance Traveled (miles)",
       #y = "Percentage (%)",
       title = "White",
       subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank())
```
```{r}
# ridgeplot attempt
ggplot(data = test_race_white) +
  geom_density_ridges(aes(x = distance_traveled_mi,
                          y = factor(above_race_average),
                          fill = race), position = "dodge") +
  scale_fill_manual(values = racial_group_colors) #+ 
  # scale_x_discrete(labels = c("1" = "Above CA Average", "0" = "Below CA Average")) +
  # scale_y_continuous(limits = c(0, 900),
  #                    breaks = seq(0, 900, 100),
  #                    minor_breaks = seq(0, 900, 50),
  #                    sec.axis = dup_axis()) +
  # labs(x = "Distance Traveled (miles)",
  #      #y = "Percentage (%)",
  #      title = "White",
  #      subtitle = "Distance Traveled Compared to Racial Breakdown of Home \nfor Overnight Reservations in California") +
  # theme_minimal() +
  # theme(legend.position = "none",
  #       plot.background = element_rect("white"),
  #       panel.grid.major.y = element_blank())
```



#### (Option 3)

```{r}
## -- data wrangle -- ##
data_plot_race_distance_traveled_3 <- data_plot_race_distance_traveled_bins %>% 
  filter(park == "Upper Pines") %>% 
  group_by(customer_zip, distance_traveled_mi, asian, black, hispanic_latinx, 
         multiracial, native_american, other, pacific_islander, white) %>% 
  summarise(visits = n()) %>% 
  pivot_longer(cols = 3:10,
               names_to = "race",
               values_to = "race_percent") %>% 
  mutate(race_estimate = round(visits * race_percent, 0)) %>% 
  mutate(race = str_replace(string = race,
                            pattern = "_",
                            replacement = " "),
         race = str_to_title(race)) %>% 
  filter(race_estimate > 0)

## group_by race and sum race_estimate to and add to single variable table --- use as a check
## thinking about using this for things that don't 

## -- create plot -- ##

# parameters
racial_group_colors <- c("Other" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")

# plot
plot_race_distance_traveled_3 <- ggplot(data_plot_race_distance_traveled_3, aes(distance_traveled_mi)) + 
  geom_histogram(aes(weights = race_estimate)) + 
  facet_wrap(~race, scales = "free") +
  scale_fill_manual(values = racial_group_colors) +
  # scale_x_discrete(labels = c("1" = "0 - 60 mi",
  #                             "2" = "60 - 117 mi",
  #                             "3" = "117 - 181 mi",
  #                             "4" = "181 - 299 mi",
  #                             "5" = "299 - 3,614 mi")) +
  labs(x = "Distance Traveled (miles)",
       y = "Estimated Number of Visits",
       title = "Race vs. Distance Traveled",
       subtitle = "for Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.x = element_blank())

plot_race_distance_traveled_3

## look at weighted density plots


```




### Race x site type 

#### (Option 1)

```{r}
## -- data wrangle -- ##
data_plot_race_site_type <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, customer_zip, asian, black, hispanic_latinx, 
         multiracial, native_american, other, pacific_islander, white,
         aggregated_site_type) %>% 
  group_by(aggregated_site_type) %>% 
  summarize(white = (mean(white, na.rm = TRUE) * 100),
            black = (mean(black, na.rm = TRUE) * 100),
            asian = (mean(asian, na.rm = TRUE) * 100),
            multiracial = (mean(multiracial, na.rm = TRUE) * 100),
            other = (mean(other, na.rm = TRUE) * 100),
            native_american = (mean(native_american, na.rm = TRUE) * 100),
            pacific_islander = (mean(pacific_islander, na.rm = TRUE) * 100),
            hispanic_latinx = (mean(hispanic_latinx, na.rm = TRUE) * 100)) %>% 
  pivot_longer(cols = 2:9,
               names_to = "race",
               values_to = "race_percentage") %>% 
  mutate(race = str_replace(string = race,
                            pattern = "_",
                            replacement = " "),
         race = str_to_title(race))
         

## -- create plot -- ##

# parameters
racial_group_colors <- c("Other" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")

# plot for shiny
plot_race_site_type <- ggplot(data = data_plot_race_site_type) +
  geom_col(aes(x = aggregated_site_type,
               y = race_percentage,
               fill = race)) +
  facet_wrap(~race, scales = "free_x") +
  scale_fill_manual(values = racial_group_colors) +
  # geom_vline(xintercept = c(0.5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5), 
  #            color = "lightgrey") +
  scale_x_discrete(limits = c("equestrian", "remote", "rv only", "rv or tent", "shelter", "tent only", "water"),
                   labels = c("Equestrian", "Remote", "RV Only", "RV or Tent", "Shelter", "Tent Only", "Water")) +
  labs(x = "Site Types",
       y = "Percentage (%)",
       title = "Breakdown of Race of Home ZIP Codes vs. Site Type",
       subtitle = "for Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        ) +
  coord_flip()
plot_race_site_type
```

#### (Option 2)
Box plots similar to above

#### (Option 3)
Combination of bar chart with lighter box plot on top


### Race x booking window 

#### (Option 1)

```{r}
## -- data wrangle -- ##
data_plot_race_booking_window_bins <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, customer_zip, asian, black, hispanic_latinx, 
         multiracial, native_american, other, pacific_islander, white,
         booking_window) %>% 
  filter(booking_window >= 0) %>%
  mutate(booking_window_bins = ntile(booking_window, 5)) 

data_plot_race_booking_window <- data_plot_race_booking_window_bins %>% 
  group_by(booking_window_bins) %>% 
  summarize(white = (mean(white, na.rm = TRUE) * 100),
            black = (mean(black, na.rm = TRUE) * 100),
            asian = (mean(asian, na.rm = TRUE) * 100),
            multiracial = (mean(multiracial, na.rm = TRUE) * 100),
            other = (mean(other, na.rm = TRUE) * 100),
            native_american = (mean(native_american, na.rm = TRUE) * 100),
            pacific_islander = (mean(pacific_islander, na.rm = TRUE) * 100),
            hispanic_latinx = (mean(hispanic_latinx, na.rm = TRUE) * 100)) %>% 
  pivot_longer(cols = 2:9,
               names_to = "race",
               values_to = "race_percentage") %>% 
  mutate(race = str_replace(string = race,
                            pattern = "_",
                            replacement = " "),
         race = str_to_title(race))
  
booking_window_bin_breaks <- quantile(data_plot_race_booking_window_bins$booking_window, 
                                      prob = seq(0, 1, length = 6), type = 5)
         

## -- create plot -- ##

# parameters
racial_group_colors <- c("Other" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")

# plot for shiny
plot_race_booking_window <- ggplot(data = data_plot_race_booking_window) +
  geom_col(aes(x = factor(booking_window_bins),
               y = race_percentage,
               fill = race)) +
  facet_wrap(~race, scales = "free_x") +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_discrete(labels = c("1" = "0 - 7 (days)", "2" = "7 - 27 (days)", 
                              "3" = "1 - 2.5 (months)", "4" = "2.5 - 4.5 (months)", 
                              "5" = "4.5 months - 1.8 years"), 
                   breaks = c("1", "2", "3", "4", "5")) +
  # geom_vline(xintercept = c(0.5, 1.5, 2.5, 3.5, 4.5), 
  #            color = "lightgrey") +
  labs(x = "Booking window",
       y = "Percentage (%)",
       title = "Breakdown of Race of Home ZIP Codes vs. Booking Window",
       subtitle = "for Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        ) +
  coord_flip()
plot_race_booking_window
```

#### (Option 2)
Box plots similar to above

#### (Option 3)
Combination of bar chart with lighter box plot on top



### Race x daily cost 

#### (Option 1)

```{r}
## -- data wrangle -- ##
data_plot_race_daily_cost_bins <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, customer_zip, asian, black, hispanic_latinx, 
         multiracial, native_american, other, pacific_islander, white,
         daily_cost_per_visitor) %>% 
  filter(daily_cost_per_visitor >= 0,
         daily_cost_per_visitor != "Inf") %>%
  mutate(daily_cost_per_visitor_bins = ntile(daily_cost_per_visitor, 5)) 

data_plot_race_daily_cost <- data_plot_race_daily_cost_bins %>% 
  group_by(daily_cost_per_visitor_bins) %>% 
  summarize(white = (mean(white, na.rm = TRUE) * 100),
            black = (mean(black, na.rm = TRUE) * 100),
            asian = (mean(asian, na.rm = TRUE) * 100),
            multiracial = (mean(multiracial, na.rm = TRUE) * 100),
            other = (mean(other, na.rm = TRUE) * 100),
            native_american = (mean(native_american, na.rm = TRUE) * 100),
            pacific_islander = (mean(pacific_islander, na.rm = TRUE) * 100),
            hispanic_latinx = (mean(hispanic_latinx, na.rm = TRUE) * 100)) %>% 
  pivot_longer(cols = 2:9,
               names_to = "race",
               values_to = "race_percentage") %>% 
  mutate(race = str_replace(string = race,
                            pattern = "_",
                            replacement = " "),
         race = str_to_title(race))
  
daily_cost_bin_breaks <- quantile(data_plot_race_daily_cost_bins$daily_cost_per_visitor, 
                                  prob = seq(0, 1, length = 6), type = 5)
         

## -- create plot -- ##

# parameters
racial_group_colors <- c("Other" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")

# plot for shiny
plot_race_daily_cost <- ggplot(data = data_plot_race_daily_cost) +
  geom_col(aes(x = factor(daily_cost_per_visitor_bins),
               y = race_percentage,
               fill = race)) +
  facet_wrap(~race, scales = "free_x") +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_discrete(labels = c("1" = "$0 - $2.90", "2" = "$2.90 - $5", "3" = "$5 - $7.20", 
                              "4" = "$7.20 - $13", "5" = "$13 - $279")) +
  # geom_vline(xintercept = c(0.5, 1.5, 2.5, 3.5, 4.5), 
  #            color = "lightgrey") +
  labs(x = "Daily cost per visitor ($)",
       y = "Percentage (%)",
       title = "Breakdown of Race of Home ZIP Codes vs. Daily Cost per Visitor",
       subtitle = "for Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        ) +
  coord_flip() 

plot_race_daily_cost
```

#### (Option 2)
Box plots similar to above

#### (Option 3)
Combination of bar chart with lighter box plot on top


### Race x length of stay 

#### (Option 1)

```{r}
## -- data wrangle -- ##
data_plot_race_length_of_stay_bins <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, customer_zip, asian, black, hispanic_latinx, 
         multiracial, native_american, other, pacific_islander, white,
         length_of_stay) %>% 
  mutate(length_of_stay_bins = ntile(length_of_stay, 5)) 

data_plot_race_length_of_stay <- data_plot_race_length_of_stay_bins %>% 
  group_by(length_of_stay_bins) %>% 
  summarize(white = (mean(white, na.rm = TRUE) * 100),
            black = (mean(black, na.rm = TRUE) * 100),
            asian = (mean(asian, na.rm = TRUE) * 100),
            multiracial = (mean(multiracial, na.rm = TRUE) * 100),
            other = (mean(other, na.rm = TRUE) * 100),
            native_american = (mean(native_american, na.rm = TRUE) * 100),
            pacific_islander = (mean(pacific_islander, na.rm = TRUE) * 100),
            hispanic_latinx = (mean(hispanic_latinx, na.rm = TRUE) * 100)) %>% 
  pivot_longer(cols = 2:9,
               names_to = "race",
               values_to = "race_percentage") %>% 
  mutate(race = str_replace(string = race,
                            pattern = "_",
                            replacement = " "),
         race = str_to_title(race))
  
length_of_stay_bin_breaks <- quantile(data_plot_race_length_of_stay_bins$length_of_stay, 
                                      prob = seq(0, 1, length = 6), type = 5)
         

## -- create plot -- ##

# parameters
racial_group_colors <- c("Other" = "#999999", "Pacific Islander" = "#E69F00", "Multiracial" = "#56B4E9",
                              "Asian" = "#009E73", "Black" = "#F0E442", "White" = "#0072B2", 
                              "Native American" = "#D55E00", "Hispanic Latinx" = "#CC79A7")

# plot for shiny
plot_race_length_of_stay <- ggplot(data = data_plot_race_length_of_stay) +
  geom_col(aes(x = factor(length_of_stay_bins),
               y = race_percentage,
               fill = race)) +
  facet_wrap(~race, scales = "free_x") +
  scale_fill_manual(values = racial_group_colors) +
  scale_x_discrete(labels = c("1" = "1 day", "2" = "1 - 2 days", "3" = "2 days", 
                              "4" = "2 -3 days", "5" = "3 - 22 days")) +
  # geom_vline(xintercept = c(0.5, 1.5, 2.5, 3.5, 4.5), 
  #            color = "lightgrey") +
  labs(x = "Length of Stay",
       y = "Percentage (%)",
       title = "Breakdown of Race of Home ZIP Codes vs. Length of Stay",
       subtitle = "for Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        ) +
  coord_flip()

plot_race_length_of_stay
```

#### (Option 2)
Box plots similar to above

#### (Option 3)
Combination of bar chart with lighter box plot on top



### Education x distance traveled 
#### (Option 1)

```{r}
## -- data wrangle -- ##
data_plot_education_distance_traveled_bins <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, customer_zip, college, hs_GED_or_below, 
         master_or_above, some_college, distance_traveled_m) %>% 
  mutate(distance_traveled_mi = distance_traveled_m * 0.000621371) %>% 
  drop_na(distance_traveled_mi) %>% 
  mutate(distance_traveled_bins = ntile(distance_traveled_mi, 5)) 

data_plot_education_distance_traveled <- data_plot_education_distance_traveled_bins %>% 
  group_by(distance_traveled_bins) %>% 
  summarize(college = (mean(college, na.rm = TRUE) * 100),
            hs_GED_or_below = (mean(hs_GED_or_below, na.rm = TRUE) * 100),
            master_or_above = (mean(master_or_above, na.rm = TRUE) * 100),
            some_college = (mean(some_college, na.rm = TRUE) * 100)) %>% 
  pivot_longer(cols = 2:5,
               names_to = "education",
               values_to = "education_percentage") %>% 
  mutate(education = factor(education, 
                               levels = c("hs_GED_or_below", "some_college",
                                          "college", "master_or_above")),
         education = str_replace(string = education,
                            pattern = "hs_GED_or_below",
                            replacement = "High school, GED, or below"),
         education = str_replace(string = education,
                            pattern = "some_college",
                            replacement = "Some College"),
         education = str_replace(string = education,
                            pattern = "college",
                            replacement = "Associates or bachelors degree"),
         education = str_replace(string = education,
                            pattern = "master_or_above",
                            replacement = "Masters degree or higher"))
  
distance_traveled_bin_breaks <- quantile(data_plot_race_distance_traveled_bins$distance_traveled_mi, 
                                         prob = seq(0, 1, length = 6), type = 5)
         

## -- create plot -- ##

# parameters

# plot for shiny
plot_education_distance_traveled <- ggplot(data = data_plot_education_distance_traveled) +
  geom_col(aes(x = factor(distance_traveled_bins),
               y = education_percentage,
               fill = education)) +
  facet_wrap(~education, scales = "free_x") +
  scale_fill_viridis_d() +
  scale_x_discrete(labels = c("1" = "0 - 60.2", "2" = "60.2 - 116.9", "3" = "116.9 - 180.9", 
                              "4" = "180.9 - 299.3", "5" = "299.3 - 3,613.7")) +
  # geom_vline(xintercept = c(0.5, 1.5, 2.5, 3.5, 4.5), 
  #            color = "lightgrey") +
  labs(x = "Distance Traveled (miles)",
       y = "Percentage (%)",
       title = "Breakdown of Levels of Education in Home ZIP Codes vs. Distance Traveled",
       subtitle = "for Overnight Reservations in California",
       fill = "Education") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        ) +
  coord_flip()

plot_education_distance_traveled
```

####(Option 2)
Box plots similar to above

#### (Option 3)
Combination of bar chart with lighter box plot on top


### Education x site type 

#### (Option 1)

```{r}
## -- data wrangle -- ##
data_plot_education_site_type <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, customer_zip, college, hs_GED_or_below, 
         master_or_above, some_college, aggregated_site_type) %>% 
  group_by(aggregated_site_type) %>% 
  summarize(college = (mean(college, na.rm = TRUE) * 100),
            hs_GED_or_below = (mean(hs_GED_or_below, na.rm = TRUE) * 100),
            master_or_above = (mean(master_or_above, na.rm = TRUE) * 100),
            some_college = (mean(some_college, na.rm = TRUE) * 100)) %>% 
  pivot_longer(cols = 2:5,
               names_to = "education",
               values_to = "education_percentage") %>% 
  mutate(education = factor(education, 
                               levels = c("hs_GED_or_below", "some_college",
                                          "college", "master_or_above")),
         education = str_replace(string = education,
                            pattern = "hs_GED_or_below",
                            replacement = "High school, GED, or below"),
         education = str_replace(string = education,
                            pattern = "some_college",
                            replacement = "Some College"),
         education = str_replace(string = education,
                            pattern = "college",
                            replacement = "Associates or bachelors degree"),
         education = str_replace(string = education,
                            pattern = "master_or_above",
                            replacement = "Masters degree or higher"))
         

## -- create plot -- ##

# parameters

# plot for shiny
plot_education_site_type_1 <- ggplot(data = data_plot_education_site_type) +
  geom_col(aes(x = aggregated_site_type,
               y = education_percentage,
               fill = reorder(education, education_percentage))) +
  facet_wrap(~education, scales = "free_x") +
  scale_fill_viridis_d() +
  # geom_vline(xintercept = c(0.5, 1.5, 2.5, 3.5, 4.5, 5.5, 6.5), 
  #            color = "lightgrey") +
  scale_x_discrete(limits = c("equestrian", "remote", "rv only", "rv or tent", "shelter", "tent only", "water"),
                   labels = c("Equestrian", "Remote", "RV Only", "RV or Tent", "Shelter", "Tent Only", "Water")) +
  labs(x = "Site Types",
       y = "Percentage (%)",
       fill = "Education",
       title = "Breakdown of Levels of Education in Home ZIP Codes vs. Site Type",
       subtitle = "for Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()) +
  coord_flip()

plot_education_site_type_1
```

#### (Option 2)
Box plots similar to above

#### (Option 3)
Combination of bar chart with lighter box plot on top



### Education x booking window 

#### (Option 1)

```{r}
## -- data wrangle -- ##
data_plot_education_booking_window_bins <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, customer_zip, college, hs_GED_or_below, 
         master_or_above, some_college, booking_window) %>% 
  mutate(booking_window_bins = ntile(booking_window, 5)) 

data_plot_education_booking_window <- data_plot_education_booking_window_bins %>% 
  group_by(booking_window_bins) %>% 
  summarize(college = (mean(college, na.rm = TRUE) * 100),
            hs_GED_or_below = (mean(hs_GED_or_below, na.rm = TRUE) * 100),
            master_or_above = (mean(master_or_above, na.rm = TRUE) * 100),
            some_college = (mean(some_college, na.rm = TRUE) * 100)) %>% 
  pivot_longer(cols = 2:5,
               names_to = "education",
               values_to = "education_percentage") %>% 
  mutate(education = factor(education, 
                               levels = c("hs_GED_or_below", "some_college",
                                          "college", "master_or_above")),
         education = str_replace(string = education,
                            pattern = "hs_GED_or_below",
                            replacement = "High school, GED, or below"),
         education = str_replace(string = education,
                            pattern = "some_college",
                            replacement = "Some College"),
         education = str_replace(string = education,
                            pattern = "college",
                            replacement = "Associates or bachelors degree"),
         education = str_replace(string = education,
                            pattern = "master_or_above",
                            replacement = "Masters degree or higher"))
  
booking_window_bin_breaks <- quantile(data_plot_education_booking_window_bins$booking_window, 
                                      prob = seq(0, 1, length = 6), type = 5)
         

## -- create plot -- ##

# parameters

# plot for shiny
plot_education_booking_window <- ggplot(data = data_plot_education_booking_window) +
  geom_col(aes(x = factor(booking_window_bins),
               y = education_percentage,
               fill = education)) +
  facet_wrap(~education, scales = "free_x") +
  scale_fill_viridis_d() +
  scale_x_discrete(labels = c("1" = "0 - 7 (days)", "2" = "7 - 27 (days)", 
                              "3" = "1 - 2.5 (months)", "4" = "2.5 - 4.5 (months)", 
                              "5" = "4.5 months - 1.8 years")) +
  # geom_vline(xintercept = c(0.5, 1.5, 2.5, 3.5, 4.5), 
  #            color = "lightgrey") +
  labs(x = "Booking window",
       y = "Percentage (%)",
       title = "Breakdown of Levels of Education in Home ZIP Codes \nvs. Booking Window",
       subtitle = "for Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.x = element_blank()
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        ) +
  coord_flip()

plot_education_booking_window
```

#### (Option 2)
Box plots similar to above

#### (Option 3)
Combination of bar chart with lighter box plot on top



### Education x daily cost 

#### (Option 1)

```{r}
## -- data wrangle -- ##
data_plot_education_daily_cost_bins <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, customer_zip, college, hs_GED_or_below, 
         master_or_above, some_college, daily_cost_per_visitor) %>% 
  mutate(daily_cost_per_visitor_bins = ntile(daily_cost_per_visitor, 5)) 

data_plot_education_daily_cost <- data_plot_education_daily_cost_bins %>% 
  group_by(daily_cost_per_visitor_bins) %>% 
  summarize(college = (mean(college, na.rm = TRUE) * 100),
            hs_GED_or_below = (mean(hs_GED_or_below, na.rm = TRUE) * 100),
            master_or_above = (mean(master_or_above, na.rm = TRUE) * 100),
            some_college = (mean(some_college, na.rm = TRUE) * 100)) %>% 
  pivot_longer(cols = 2:5,
               names_to = "education",
               values_to = "education_percentage") %>% 
  mutate(education = factor(education, 
                               levels = c("hs_GED_or_below", "some_college",
                                          "college", "master_or_above")),
         education = str_replace(string = education,
                            pattern = "hs_GED_or_below",
                            replacement = "High school, GED, or below"),
         education = str_replace(string = education,
                            pattern = "some_college",
                            replacement = "Some College"),
         education = str_replace(string = education,
                            pattern = "college",
                            replacement = "Associates or bachelors degree"),
         education = str_replace(string = education,
                            pattern = "master_or_above",
                            replacement = "Masters degree or higher"))
  
daily_cost_bin_breaks <- quantile(data_plot_education_daily_cost_bins$daily_cost_per_visitor, 
                                  prob = seq(0, 1, length = 6), type = 5)
         

## -- create plot -- ##

# parameters

# plot for shiny
plot_education_daily_cost <- ggplot(data = data_plot_education_daily_cost) +
  geom_col(aes(x = factor(daily_cost_per_visitor_bins),
               y = education_percentage,
               fill = education)) +
  facet_wrap(~education, scales = "free_x") +
  scale_fill_viridis_d() +
  scale_x_discrete(labels = c("1" = "$0 - $2.90", "2" = "$2.90 - $5", "3" = "$5 - $7.20", 
                              "4" = "$7.20 - $13", "5" = "$13 - $279")) +
  # geom_vline(xintercept = c(0.5, 1.5, 2.5, 3.5, 4.5), 
  #            color = "lightgrey") +
  labs(x = "Daily cost per visitor ($)",
       y = "Percentage (%)",
       title = "Breakdown of Levels of Education in Home ZIP Codes \nvs. Daily Cost per Visitor",
       subtitle = "for Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        ) +
  coord_flip()

plot_education_daily_cost
```

#### (Option 2)
Box plots similar to above

#### (Option 3)
Combination of bar chart with lighter box plot on top


### Education x length of stay 

#### (Option 1)

```{r}
## -- data wrangle -- ##
data_plot_education_length_of_stay_bins <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, customer_zip, college, hs_GED_or_below, 
         master_or_above, some_college, length_of_stay) %>% 
  mutate(length_of_stay_bins = ntile(length_of_stay, 5)) 

data_plot_education_length_of_stay <- data_plot_education_length_of_stay_bins %>% 
  group_by(length_of_stay_bins) %>% 
  summarize(college = (mean(college, na.rm = TRUE) * 100),
            hs_GED_or_below = (mean(hs_GED_or_below, na.rm = TRUE) * 100),
            master_or_above = (mean(master_or_above, na.rm = TRUE) * 100),
            some_college = (mean(some_college, na.rm = TRUE) * 100)) %>% 
  pivot_longer(cols = 2:5,
               names_to = "education",
               values_to = "education_percentage") %>% 
  mutate(education = factor(education, 
                               levels = c("hs_GED_or_below", "some_college",
                                          "college", "master_or_above")),
         education = str_replace(string = education,
                            pattern = "hs_GED_or_below",
                            replacement = "High school, GED, or below"),
         education = str_replace(string = education,
                            pattern = "some_college",
                            replacement = "Some College"),
         education = str_replace(string = education,
                            pattern = "college",
                            replacement = "Associates or bachelors degree"),
         education = str_replace(string = education,
                            pattern = "master_or_above",
                            replacement = "Masters degree or higher"))
  
length_of_stay_bin_breaks <- quantile(data_plot_education_length_of_stay_bins$length_of_stay, 
                                      prob = seq(0, 1, length = 6), type = 5)
         

## -- create plot -- ##

# parameters

# plot for shiny
plot_education_length_of_stay <- ggplot(data = data_plot_education_length_of_stay) +
  geom_col(aes(x = factor(length_of_stay_bins),
               y = education_percentage,
               fill = education)) +
  facet_wrap(~education, scales = "free_x") +
  scale_fill_viridis_d() +
  scale_x_discrete(labels = c("1" = "1 day", "2" = "1 - 2 days", "3" = "2 days", 
                              "4" = "2 -3 days", "5" = "3 - 22 days")) +
  # geom_vline(xintercept = c(0.5, 1.5, 2.5, 3.5, 4.5), 
  #            color = "lightgrey") +
  labs(x = "Length of Stay",
       y = "Percentage (%)",
       title = "Breakdown of Levels of Education in Home ZIP Codes \nvs. Length of Stay",
       subtitle = "for Overnight Reservations in California") +
  theme_minimal() +
  theme(legend.position = "none",
        plot.background = element_rect("white"),
        panel.grid.major.x = element_blank()
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        ) +
  coord_flip()

plot_education_length_of_stay
```

#### (Option 2)
Box plots similar to above

#### (Option 3)
Combination of bar chart with lighter box plot on top



### Language 

Similar graphs to those above would exist for:

* Language x distance traveled
* Language x site type
* Language x booking window
* Language x daily cost
* Language x length of stay


### Median-income x distance traveled

Similar graphs to those above would exist for:

* Median-income x distance traveled
* Median-income x site type
* Median-income x booking window
* Median-income x daily cost
* Median-income x length of stay


### Booking window x site type

```{r}
## -- data wrangle -- ##
data_plot_booking_window_site_type <- data_ridb_acs_2018 %>% 
  #select(agency, admin_unit, park, booking_window, aggregated_site_type) %>% 
  group_by(aggregated_site_type) %>% 
  summarise(mean_booking_window = mean(booking_window, na.rm = TRUE)) %>% 
  mutate(aggregated_site_type = str_to_title(aggregated_site_type))

## -- create plot -- ##

# parameters

# plot for shiny
plot_booking_window_site_type <- ggplot(data = data_plot_booking_window_site_type) +
  geom_col(aes(y = reorder(aggregated_site_type, mean_booking_window),
           x = mean_booking_window), fill = "#009900FF") +
  labs(x = "Booking Window (days)",
       y = "",
       title = "Booking Window vs. Distance Traveled",
       subtitle = "for Overnight Reservations in California") +
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.x = element_blank(),
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        )

plot_booking_window_site_type
```


### Booking window x distance traveled
Similar graphs to those above would exist for booking window x distance traveled


```{r}
end_time <- Sys.time()
time_taken <- end_time - start_time
time_taken
```


```{r, eval=FALSE}
## Save plot dataframes to RDS

plot_data <- c("data_plot_race_distance_traveled", "data_plot_race_site_type", 
               "data_plot_race_booking_window", "data_plot_race_daily_cost", 
               "data_plot_race_length_of_stay", "data_plot_education_distance_traveled", 
               "data_plot_education_site_type", "data_plot_education_booking_window", 
               "data_plot_education_daily_cost", "data_plot_education_length_of_stay", 
               "data_plot_booking_window_site_type")


for (i in seq_along(plot_data)){
  saveRDS(object = get(plot_data[[i]]),
          file = paste0("../../../../data_clean/2018_data_graphs_comparison_variables/2018_", 
                        plot_data[[i]],
                        ".rds"))
}
```


