---
title: "Data Viz for Shiny App"
author: "Clarissa"
date: "3/16/2022"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(sf)
library(tidycensus)
library(patchwork)
library(scales)
library(tmap)
library(vroom)
library(paletteer)
library(plotly)

options(scipen = 999)
```


```{r}
start_time <- Sys.time()
```

```{r load data}
# read in joined data
data_ridb_acs_2018 <- vroom(file = "../../../../data_clean/2018_joined_data.csv",
                            delim = ",")
# data_ridb_acs_2018 <- readRDS(file = "../../../../data_clean/2018_joined_data.rds") # don't use RDS for non-map viz

# ACS CA data
data_ca_acs_2018 <- vroom(file = "../../../../data_clean/2018_ca_acs_all.csv",
                            delim = ",")

```



## Agency Analysis: Distribution Graphs

### Distance traveled

```{r}
## -- data wrangle -- ##
data_plot_distance_traveled <- data_ridb_acs_2018 %>% 
  mutate(distance_traveled_mi = distance_traveled_m * 0.000621371) %>% 
  select(park, distance_traveled_mi) %>% 
  filter(!is.na(distance_traveled_mi))

x_max <- (round(max(data_plot_distance_traveled$distance_traveled_mi) / 5) * 5) + 5 # max x rounded to nearest 5

center_bin <-
  if (x_max > 100) {
    round((max(data_plot_distance_traveled$distance_traveled_mi) / 100) / 5) * 5
  } else if (x_max > 10) {
    round((max(data_plot_distance_traveled$distance_traveled_mi) / 10) / 5) * 5
  } else {
    0.5
  }

quant_80 <- quantile(x = data_plot_distance_traveled$distance_traveled_mi,
                     probs = seq(0, 1, 0.1))[[9]] %>% round(0)

## -- create plot -- ##

# parameters
hist_colors <- c("#009900FF")

# plot for shiny app
plot_distance_traveled <-
  ggplot(data = data_plot_distance_traveled) +
  geom_histogram(aes(x = distance_traveled_mi,
                       text = paste0(percent(..count.. / nrow(data_plot_distance_traveled), accuracy = 0.1), 
                                     " of all reservations traveled between ", comma(xmin, accuracy = 1), " and ", 
                                     comma(xmax, accuracy = 1), " miles", "<br>(", comma(..count.., accuracy = 1), 
                                     " of ", comma(nrow(data_plot_distance_traveled), accuracy = 1), 
                                     " total reservations to ", "siteInput", "admin_unitInput", ")")),
                 fill = hist_colors) +
  scale_y_continuous(labels = comma) +
  labs(x = "Distance traveled (miles)",
       y = "",
       title = "Distribution of Distance Traveled to ",
       subtitle = "Overnight Reservations in California in 2018") +
  scale_x_continuous(limits = c(0, 3000), breaks = seq(0, 3000, 500), minor_breaks = seq(0, 3000, 250)) +
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        )

ggplotly(plot_distance_traveled,
           tooltip = list("text")) %>% 
    layout(margin = list(b = 130, t = 100), 
           annotations =  list(x = 1, 
                               y = -0.5, 
                               text = paste0("80% of reservations to California overnight sites in 2018 traveled less than ", 
                                             quant_80, " miles (shown on plot with dotted line)."), 
                               showarrow = F, 
                               xre = 'paper', yref = 'paper', 
                               xanchor = 'left', 
                               yanchor = 'auto', 
                               xshift = 0, yshift = 0,
                               font = list(size = 12, color = "#000099")))
```


### Booking window

```{r}
## -- data wrangle -- ##
data_plot_boooking_window <- data_ridb_acs_2018 %>% 
  filter(booking_window > 0,
         booking_window < 510) %>% 
  select(park, booking_window)

x_max <- (round(max(data_plot_boooking_window$booking_window) / 5) * 5) + 5 # max x rounded to nearest 5

quant_80 <- quantile(x = data_plot_boooking_window$booking_window,
                       probs = seq(0, 1, 0.1))[[9]] %>% round(0)

## -- create plot -- ##

# parameters
hist_colors <- c("#009900FF", "#00c000")

# plot for shiny app
plot_booking_window <- ggplot(data = data_plot_boooking_window) +
  geom_histogram(aes(x = booking_window,
                     text = paste0(percent(..count.. / nrow(data_plot_boooking_window), accuracy = 0.1), 
                                  " of all reservations book their visit between ", xmin, " and ", xmax, 
                                  "<br>days before the start of their visit", "<br>(", comma(..count.., accuracy = 1), " of ", 
                                  comma(nrow(data_plot_boooking_window), accuracy = 1), " total reservations to ", siteInput, 
                                  ", ", admin_unitInput, " in 2018)")),
                 binwidth = 7,
                 center = 7 / 2,
                 fill = hist_colors[[1]], 
                 col = hist_colors[[2]], size = 0.05) +
  labs(x = "Days elapsed from order to visit (each bar = 1 week)",
       y = "",
       title = paste0("Number of Days Before a Visit that Reservations are Booked", "<br>for ", 
                      siteInput, ", ", admin_unitInput)) +
  scale_x_continuous(limits = c(0, x_max), breaks = seq(0, x_max, 30)) +
  scale_y_continuous(labels = comma) +
  geom_vline(xintercept = quant_80,
               linetype = "dashed", alpha = 0.5, color = "#000099") +
  geom_vline(xintercept = 180, 
             linetype = "dashed", size = .3, alpha = .5) +
  annotate("text", label = "6 months", 
           x = 210, y = 65000) +
  geom_vline(xintercept = 360, 
             linetype = "dashed", size = .3, alpha = .5) +
  annotate("text", label = "1 year", 
           x = 380, y = 65000) +
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank())

ggplotly(plot_booking_window,
         tooltip = list("text")) %>% 
  layout(margin = list(b = 130, t = 100), 
         annotations =  list(x = 1, 
                             y = -0.5, 
                             text = paste0("80% of reservations to ", siteInput, ", ", admin_unitInput, 
                                           "<br> reserve their visit less than ", quant_80, 
                                           " days before the start date <br>(shown on plot with dashed line)."), 
                             showarrow = F, 
                             xre = 'paper', yref = 'paper', 
                             xanchor = 'left', 
                             yanchor = 'auto', 
                             xshift = 0, yshift = 0,
                             font = list(size = 12, color = "#000099")))
```


### Daily cost per visitor

```{r}
## -- data wrangle -- ##
data_plot_daily_cost <- data_ridb_acs_2018 %>% 
  filter(daily_cost != "Inf",
         daily_cost <= 50) %>% 
  select(agency, admin_unit, park, daily_cost)

## -- create plot -- ##

# parameters
hist_colors <- c("#009900FF")

# plot for shiny app
plot_daily_cost <-
  ggplot(data = data_plot_daily_cost) +
  geom_histogram(aes(x = daily_cost),
                 fill = hist_colors) +
  labs(x = "Daily cost per visitor ($)",
       y = "",
       title = "Distribution of Daily Costs per Visitor for",
       subtitle = "Overnight Reservations in California in 2018") +
  scale_x_continuous(limits = c(0, 50), breaks = seq(0, 50, by = 10)) +
  scale_y_continuous(labels = comma) +
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        )
plot_daily_cost
```


### Length of Stay

```{r}
## -- data wrangle -- ##
data_plot_length_of_stay <- data_ridb_acs_2018 %>% 
  select(park, length_of_stay)

x_max <- (round(max(data_plot_length_of_stay$length_of_stay) / 5) * 5) + 5 # max x rounded to nearest 5

quant_80 <- quantile(x = data_plot_length_of_stay$length_of_stay,
                     probs = seq(0, 1, 0.1))[[9]] %>% round(0)

## -- create plot -- ##

# parameters
hist_colors <- c("#009900FF", "#00c000")

# plot for shiny app
plot_length_of_stay <- ggplot(data = data_plot_length_of_stay) +
  geom_histogram(aes(x = length_of_stay,
                     text = paste0(percent(..count.. / nrow(data_plot_length_of_stay), accuracy = 0.1), 
                                   " of all reservations stay between ", xmin, " and ", xmax, " days",
                                   "<br>(", comma(..count.., accuracy = 1), " of ", comma(nrow(data_plot_length_of_stay)), 
                                   " total reservations to ", siteInput, ", ", admin_unitInput, ")")),
                 binwidth = 1,
                 center = 0.5,
                 fill = hist_colors[[1]], 
                 col = hist_colors[[2]], size = 0.05) +
  scale_x_continuous(limits = c(0, x_max)) +
  scale_y_continuous(labels = comma) +
  geom_vline(xintercept = quant_80,
             linetype = "dashed", alpha = 0.5, color = "#000099") +
  labs(x = "Length of visit (days)",
       y = "",
       title = paste0("Length of Visit for Reservations at <br>", 
                      siteInput, ", ", admin_unitInput, " in 2018")) +
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank())

ggplotly(plot_length_of_stay,
         tooltip = list("text")) %>% 
  layout(margin = list(b = 130, t = 100), 
         annotations =  list(x = 1, 
                             y = -0.5, 
                             text = paste0("80% of reservations to ", siteInput, ", ", admin_unitInput, 
                                           " stay less than ", quant_80, " days (shown on plot with dashed line)."), 
                             showarrow = F, 
                             xre = 'paper', yref = 'paper', 
                             xanchor = 'left', 
                             yanchor = 'auto', 
                             xshift = 0, yshift = 0,
                             font = list(size = 12, color = "#000099")))
```


### Site Type

```{r}
## -- data wrangle -- ##
data_plot_site_type <- data_ridb_acs_2018 %>% 
  select(agency, admin_unit, park, aggregated_site_type)

 
## -- create plot -- ##

# parameters
hist_colors <- c("#009900FF")

# plot for shiny app
plot_site_type <-
  ggplot(data = data_plot_site_type %>% 
           group_by(aggregated_site_type) %>% 
           summarise(count = n())) +
  geom_col(aes(x = count,
               y = reorder(aggregated_site_type, count)),
           fill = hist_colors) +
  scale_x_continuous(labels = comma) +
  labs(x = "Number of Sites",
       y = "Types of Sites",
       title = "Distribution of Type of Sites for",
       subtitle = "Overnight Reservations in California in 2018") +
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        )
plot_site_type
```


### Race

```{r}
## -- data wrangle -- ##

# reservations in CA
data_plot_race_ridb <- data_ridb_acs_2018 %>%
  summarize(white = (mean(white, na.rm = TRUE) * 100),
            black = (mean(black, na.rm = TRUE) * 100),
            asian = (mean(asian, na.rm = TRUE) * 100),
            multiracial = (mean(multiracial, na.rm = TRUE) * 100),
            other = (mean(other, na.rm = TRUE) * 100),
            native_american = (mean(native_american, na.rm = TRUE) * 100),
            pacific_islander = (mean(pacific_islander, na.rm = TRUE) * 100),
            hispanic_latinx = (mean(hispanic_latinx, na.rm = TRUE) * 100)) %>%
  pivot_longer(cols = 1:8, names_to = "race", values_to = "race_percent_average") %>% 
  mutate(race = str_replace(string = race,
                            pattern = "_",
                            replacement = " "),
         race = str_to_title(race))

# CA population
data_plot_race_ca <- data_ca_acs_2018 %>%
  summarize(white = (weighted.mean(white, mean_zip_code_population, 
                                   na.rm = TRUE) * 100),
            black = (weighted.mean(black,  mean_zip_code_population,
                                   na.rm = TRUE) * 100),
            asian = (weighted.mean(asian, mean_zip_code_population, 
                                   na.rm = TRUE) * 100),
            multiracial = (weighted.mean(multiracial, mean_zip_code_population, 
                                na.rm = TRUE) * 100),
            other = (weighted.mean(other, mean_zip_code_population, 
                                   na.rm = TRUE) * 100),
            native_american = (weighted.mean(native_american, mean_zip_code_population, 
                                             na.rm = TRUE) * 100),
            pacific_islander = (weighted.mean(pacific_islander, mean_zip_code_population, 
                                              na.rm = TRUE) * 100),
            hispanic_latinx = (weighted.mean(hispanic_latinx, mean_zip_code_population, 
                                             na.rm = TRUE) * 100)) %>%
  pivot_longer(cols = 1:8, names_to = "race", values_to = "race_percent_average") %>% 
  mutate(race = str_replace(string = race,
                            pattern = "_",
                            replacement = " "),
         race = str_to_title(race))

# join data for plotting
data_plot_race <- data_plot_race_ridb %>% 
  left_join(y = data_plot_race_ca,
            by = c("race"),
            suffix = c("_ridb", "_ca")) %>% 
  rename(RIDB = race_percent_average_ridb,
         CA = race_percent_average_ca) %>% 
  pivot_longer(cols = 2:3,
               names_to = "data_source",
               values_to = "race_percent_average") %>% 
  mutate(data_source = factor(data_source, levels = c("RIDB", "CA")))

## -- create plot -- ##

# parameters
groups_colors_ridb_ca <- c("RIDB" = "#009900FF", "CA" = "#666666")

# plot for shiny app
plot_race <- 
  ggplot(data = data_plot_race) +
  geom_col(aes(x = race_percent_average,
               y = reorder(race, race_percent_average),
               fill = data_source),
           stat = "identity",
           position = "dodge") +
  scale_fill_manual(values = groups_colors_ridb_ca) +  
  geom_text(aes(x = race_percent_average,
                y = reorder(race, race_percent_average),
                label = paste0(round(race_percent_average, 1), "%"),
                col = data_source), 
            position = position_dodge(width = 1), 
            hjust = -0.1, size = 4) +
  scale_color_manual(values = groups_colors_ridb_ca) +
  labs(x = "Percentage (%)",
       y = "",
       title = "Racial Breakdown of ZIP Codes in 2018",
       subtitle = "Visitors' home ZIP codes for Overnight Reservations in California \nvs. California Residents") +
  scale_x_continuous(limits = c(0, 60), breaks = seq(0, 60, 10), minor_breaks = seq(0, 60, 5)) +
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank())
plot_race
```

### Education

```{r}
## -- data wrangle -- ##

# reservations in CA
data_plot_education_ridb <- data_ridb_acs_2018 %>%
  summarize(hs_GED_or_below = (mean(hs_GED_or_below, na.rm = TRUE) * 100),
            some_college = (mean(some_college, na.rm = TRUE) * 100),
            college = (mean(college, na.rm = TRUE) * 100),
            master_or_above = (mean(master_or_above, na.rm = TRUE) * 100))  %>%
  pivot_longer(cols = 1:4, names_to = "education", values_to = "education_percent_average") %>% 
  mutate(education = str_replace(string = education,
                            pattern = "hs_GED_or_below",
                            replacement = "High school, GED, or below"),
         education = str_replace(string = education,
                            pattern = "some_college",
                            replacement = "Some College"),
         education = str_replace(string = education,
                            pattern = "college",
                            replacement = "Associates or bachelors degree"),
         education = str_replace(string = education,
                            pattern = "master_or_above",
                            replacement = "Masters degree or higher"))

# CA population
data_plot_education_ca <- data_ca_acs_2018 %>%
  summarize(hs_GED_or_below = (weighted.mean(hs_GED_or_below, mean_zip_code_population, 
                                             na.rm = TRUE) * 100),
            some_college = (weighted.mean(some_college, mean_zip_code_population, 
                                          na.rm = TRUE) * 100),
            college = (weighted.mean(college, mean_zip_code_population, 
                                     na.rm = TRUE) * 100),
            master_or_above = (weighted.mean(master_or_above, mean_zip_code_population, 
                                             na.rm = TRUE) * 100))  %>%
  pivot_longer(cols = 1:4, names_to = "education", values_to = "education_percent_average") %>% 
  mutate(education = str_replace(string = education,
                            pattern = "hs_GED_or_below",
                            replacement = "High school, GED, or below"),
         education = str_replace(string = education,
                            pattern = "some_college",
                            replacement = "Some College"),
         education = str_replace(string = education,
                            pattern = "college",
                            replacement = "Associates or bachelors degree"),
         education = str_replace(string = education,
                            pattern = "master_or_above",
                            replacement = "Masters degree or higher"))

# join data for plotting
data_plot_education <- data_plot_education_ridb %>% 
  left_join(y = data_plot_education_ca,
            by = c("education"),
            suffix = c("_ridb", "_ca")) %>% 
  rename(RIDB = education_percent_average_ridb,
         CA = education_percent_average_ca) %>% 
  pivot_longer(cols = 2:3,
               names_to = "data_source",
               values_to = "education_percent_average") %>% 
  mutate(data_source = factor(data_source, levels = c("RIDB", "CA")),
         education = factor(education, levels = c("High school, GED, or below",
                                                  "Some College", 
                                                  "Associates or bachelors degree",
                                                  "Masters degree or higher")))

## -- create plot -- ##

# parameters
groups_colors_ridb_ca <- c("RIDB" = "#009900FF", "CA" = "#666666")

# plot for shiny app
plot_education <- 
  ggplot(data = data_plot_education) +
  geom_col(aes(x = education_percent_average,
               y = education,
               fill = data_source),
           stat = "identity",
           position = "dodge") +
  scale_fill_manual(values = groups_colors_ridb_ca) +  
  geom_text(aes(x = education_percent_average,
                y = education,
                label = paste0(round(education_percent_average, 1), "%"),
                col = data_source), 
            position = position_dodge(width = 1), 
            hjust = -0.1, size = 4) +
  scale_color_manual(values = groups_colors_ridb_ca) +
  labs(x = "Percentage (%)",
       y = "",
       title = "Breakdown of Education Levels of ZIP Codes in 2018",
       subtitle = "Visitors' home ZIP codes for Overnight Reservations in California \nvs. California Residents") +
  scale_x_continuous(limits = c(0, 60), breaks = seq(0, 60, 10), minor_breaks = seq(0, 60, 5)) +
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank(),
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        )
plot_education
```


### Language
CA census (grey) not yet weighted by population

```{r}
## -- data wrangle -- ##

# reservations in CA
data_plot_language_ridb <- data_ridb_acs_2018 %>%
  select(agency, admin_unit, park, customer_zip, not_english_only, english_only) %>% 
  mutate(not_english_only = not_english_only * 100,
         english_only = english_only * 100) %>% 
  drop_na(not_english_only, english_only)

# CA population
data_plot_language_ca <- data_ca_acs_2018 %>%
  select(zip_code, not_english_only, english_only) %>% 
  mutate(not_english_only = not_english_only * 100,
         english_only = english_only * 100) %>% 
  drop_na(not_english_only, english_only)


## -- create plot -- ##

# parameters
groups_colors_ridb_ca <- c("RIDB" = "#009900FF", "CA" = "#666666")

# plot for shiny app
plot_language <- ggplot() +
  geom_histogram(data = data_plot_language_ca,
                 aes(x = not_english_only,
                     y = stat(count) / sum(count),
                     bins = 10),
                 fill = groups_colors_ridb_ca[[2]],
                 alpha = 0.75) +
  geom_histogram(data = data_plot_language_ridb,
                 aes(x = not_english_only,
                     y = stat(count) / sum(count),
                     bins = 10),
                 fill = groups_colors_ridb_ca[[1]],
                 alpha = 0.75) +
  labs(x = "Percentage (%)",
       y = "",
       title = "Distribution of Non-English Spoken in the Home in ZIP Codes in 2018",
       subtitle = "Visitors' home ZIP codes for Overnight Reservations in California \nvs. California Residents") +
  scale_x_continuous(breaks = seq(0, 100, 10), minor_breaks = seq(0, 100, 5)) +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        )
plot_language
```



### Median income
CA census (grey) not yet weighted by population

```{r}
## -- data wrangle -- ##

# reservations in CA
data_plot_median_income_ridb <- data_ridb_acs_2018 %>%
  select(agency, admin_unit, park, customer_zip, median_income)

# CA population
data_plot_median_income_ca <- data_ca_acs_2018 %>%
  select(zip_code, median_income)


## -- create plot -- ##

# parameters
groups_colors_ridb_ca <- c("RIDB" = "#009900FF", "CA" = "#666666")

# plot for shiny app
plot_median_income <- ggplot() +
  geom_histogram(data = data_plot_median_income_ca,
                 aes(x = median_income,
                     y = stat(count) / sum(count),
                     bins = 10),
                 fill = groups_colors_ridb_ca[[2]], 
                 alpha = 0.75) +
  geom_histogram(data = data_plot_median_income_ridb,
                 aes(x = median_income,
                     y = stat(count) / sum(count),
                     bins = 10), 
                 fill = groups_colors_ridb_ca[[1]], 
                 alpha = 0.75) +
  geom_vline(xintercept = 75277, 
             linetype = "dashed", size = .3, alpha = .5) +
  annotate("text", label = "Median household income \nin 2018 in CA ($75,277)", 
           x = 118000, y = .15) +
  labs(x = "Median Income ($))",
       y = "",
       title = "Distribution of Median Income in Home in ZIP Codes in 2018",
       subtitle = "Visitors' home ZIP codes for Overnight Reservations in California \nvs. California Residents") +
  scale_x_continuous(limits = c(0, 260000), breaks = seq(0, 260000, 50000), minor_breaks = seq(0, 260000, 25000), labels = comma) +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal() +
  theme(plot.background = element_rect("white"),
        panel.grid.major.y = element_blank()
        # ## only needed for saving as image
        # axis.text = element_text(size = 20),
        # axis.title = element_text(size = 22, face = "bold"),
        # title = element_text(size = 24, face = "bold")
        )
plot_median_income
```


### Total reservations (by agency)

```{r}
## -- data wrangle -- ##

data_plot_agency_park <- data_ridb_acs_2018 %>% 
  group_by(agency, park) %>% 
  summarise(count = n())

## -- create plot -- ##

# plot for shiny app
plot_agency_site <- 
  ggplot(data_plot_agency_park) +
  geom_bar(aes(y = fct_infreq(agency, )), fill = "#009900FF") +
  scale_y_discrete(labels = c("BOR" = "Bureau of Reclamation", "NPS" = "National Park Service", 
                              "USACE" = "US Army Corps of Engineers", "USFS" = "US Forest Service")) +
  scale_x_continuous(limits = c(0, 400), breaks = seq(0, 400, 100), minor_breaks = seq(0, 40, 50)) +
  theme_minimal() +
  labs(fill = "Agency",
       y = "Agency",
       x = "Reservable Site Count",
       title = "Total Sites per Agency \nfor Reservable Overnight Sites in California in 2018") +
  theme(panel.grid.major.y = element_blank(),
        plot.background = element_rect("white"),
        # ## only needed for saving as image
        # axis.text = element_text(size = 12),
        # axis.title = element_text(size = 14, face = "bold"),
        # title = element_text(size = 16, face = "bold")
        )
plot_agency_site
```

### Total Reservations (by agency)

```{r}
## -- data wrangle -- ##

## -- create plot -- ##

# plot for shiny app
plot_agency_visits <- 
  ggplot(data = data_ridb_acs_2018) +
  geom_bar(aes(y = fct_infreq(agency)), fill = "#009900FF") +
  scale_y_discrete(labels = c("BOR" = "Bureau of Reclamation", "NPS" = "National Park Service", 
                              "USACE" = "US Army Corps of Engineers", "USFS" = "US Forest Service")) +
  #scale_x_continuous(limits = c(0, 400), breaks = seq(0, 400, 100), minor_breaks = seq(0, 40, 50)) +
  theme_minimal() +
  labs(y = "",
       x = "Total Reservations per Agency",
       fill = "Agency",
       title = "Total Reservations per Agency \nfor Reservable Overnight Sites in California in 2018") +
  theme(panel.grid.minor.x = element_blank(),
        plot.background = element_rect("white"),
        # ## only needed for saving as image
        # axis.text = element_text(size = 12),
        # axis.title = element_text(size = 14, face = "bold"),
        # title = element_text(size = 16, face = "bold")
        )
plot_agency_visits
```


```{r}
end_time <- Sys.time()
time_taken <- end_time - start_time
time_taken
```



```{r, eval=FALSE}
## Save plot all data to RDS

plot_data <- c("data_plot_distance_traveled", "data_plot_boooking_window", 
               "data_plot_daily_cost", "data_plot_length_of_stay", 
               "data_plot_site_type", "data_plot_race", 
               "data_plot_education", "data_plot_language_ca", 
               "data_plot_language_ridb", "data_plot_median_income_ca",
               "data_plot_median_income_ridb", "data_plot_agency_park")

for (i in seq_along(plot_data)){
  saveRDS(object = get(plot_data[[i]]),
          file = paste0("../../../../data_clean/2018_data_graphs_single_variable/2018_", 
                        plot_data[[i]],
                        ".rds"))
}
```



