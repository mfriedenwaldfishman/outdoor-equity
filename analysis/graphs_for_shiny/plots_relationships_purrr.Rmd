---
title: "Trying out purr for plot functions"
author: "Clarissa"
date: "4/19/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(here)
library(janitor)
library(tidycensus)
library(scales)
library(vroom)
library(plotly)
```


```{r}
# create function for census data

racial_groups <- c("other", "pacific_islander", "multiracial", "asian", 
                   "black", "white", "native_american", "hispanic_latinx")

function_quartile <- function(race_group, acs_df){
  
  data_plot_race_distance_traveled <- data.frame()
  
  df_ca_bin_breaks <- acs_df %>%
    select(zip_code, asian, black, hispanic_latinx, multiracial,
           native_american, other, pacific_islander, white, mean_zip_code_population) %>%
    pivot_longer(cols = 2:9,
                 names_to = "race",
                 values_to = "race_percentage") %>%
    filter(race == race_group) %>% ## BACK TO i
    drop_na(race_percentage)
  
  weighted_half <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  df_ca_bin_breaks <- df_ca_bin_breaks %>% filter(race_percentage >= weighted_half)
  
  weighted_quartile <- weighted.mean(x = df_ca_bin_breaks$race_percentage, w = df_ca_bin_breaks$mean_zip_code_population)
  
  assign(paste0("top_quartile_ca_race_", race_group),
         c(weighted_quartile),
         envir = .GlobalEnv)
}
```


```{r}
racial_groups <- c("other", "pacific_islander", "multiracial", "asian", 
                   "black", "white", "native_american", "hispanic_latinx")

data_plot_race_distance_traveled <- data.frame()

# create plot df for each group for RIDB data
for (i in seq_along(racial_groups)){
  
  df_racial_group_i_longer <- data_ridb_acs_2018 %>% 
    select(agency, admin_unit, park, customer_zip, asian, black, hispanic_latinx, 
           multiracial, native_american, other, pacific_islander, white,
           distance_traveled_m) %>% 
    mutate(distance_traveled_mi = distance_traveled_m * 0.000621371) %>% 
    drop_na(distance_traveled_mi) %>% 
  pivot_longer(cols = 5:12,
               names_to = "race",
               values_to = "race_percentage") %>% 
    filter(race == racial_groups[[i]]) %>% ## BACK TO i
    drop_na(race_percentage)

  max_racial_group_ridb <- df_racial_group_i_longer %>%
    summarize(max = max(race_percentage))

  df_racial_group_i <- df_racial_group_i_longer %>%
    filter(race_percentage >= weighted_quartile) %>% 
    summarize(mean_distance_traveled_mi = mean(distance_traveled_mi)) %>% 
    mutate(race = paste0(racial_groups[[i]])) %>%  ## BACK TO i
    relocate(race, .before = 1) %>% 
    mutate(race = str_replace(string = race,
                              pattern = "_",
                              replacement = " "),
           race = str_to_title(race),
           race = str_replace(string = race,
                              pattern = "Other",
                              replacement = "Other Race(s)"))

  data_plot_race_distance_traveled <- rbind(data_plot_race_distance_traveled, df_racial_group_i)

  assign(paste0("max_race_ridb_", racial_groups[[i]]),
         data.frame(max_racial_group_ridb),
         envir = .GlobalEnv)
}
```

